<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.3.433">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Lianne Sheppard for ENVH 556 Autumn 2024">

<title>Week3Lecture</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="Week3Lecture_files/libs/clipboard/clipboard.min.js"></script>
<script src="Week3Lecture_files/libs/quarto-html/quarto.js"></script>
<script src="Week3Lecture_files/libs/quarto-html/popper.min.js"></script>
<script src="Week3Lecture_files/libs/quarto-html/tippy.umd.min.js"></script>
<script src="Week3Lecture_files/libs/quarto-html/anchor.min.js"></script>
<link href="Week3Lecture_files/libs/quarto-html/tippy.css" rel="stylesheet">
<link href="Week3Lecture_files/libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="Week3Lecture_files/libs/bootstrap/bootstrap.min.js"></script>
<link href="Week3Lecture_files/libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="Week3Lecture_files/libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">


</head>

<body class="fullcontent">

<div id="quarto-content" class="page-columns page-rows-contents page-layout-article">

<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Week3Lecture</h1>
</div>



<div class="quarto-title-meta">

    <div>
    <div class="quarto-title-meta-heading">Author</div>
    <div class="quarto-title-meta-contents">
             <p>Lianne Sheppard for ENVH 556 Autumn 2024 </p>
          </div>
  </div>
    
  
    
  </div>
  

</header>

<p>This document was rendered on September 25, 2024.</p>
<!--Basic document set-up goes here  -->
<p>This is a companion document to the Week 3 lecture. Each slide with R code is represented in this document. This document also has a few additional alternative coding options.</p>
<section id="slide-10-simple-regression-scatterplot-ln_nox-on-ln_no" class="level2">
<h2 class="anchored" data-anchor-id="slide-10-simple-regression-scatterplot-ln_nox-on-ln_no">Slide 10: Simple regression scatterplot ln_nox on ln_no</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="co">#-----slide10----</span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a>(p <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(<span class="at">data=</span>snapshot,<span class="fu">aes</span>(ln_no,ln_nox)) <span class="sc">+</span></span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a>     <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a>     <span class="fu">labs</span>(</span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a>        <span class="at">title=</span><span class="st">"Association between NO and NOx on the log scale"</span>,</span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a>        <span class="at">x=</span><span class="st">"ln(NO) (ln(ppb))"</span>,</span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a>        <span class="at">y=</span><span class="st">"ln(NOx) (ln(ppb))"</span></span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a>    ) )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="Week3Lecture_files/figure-html/slide10-1.png" class="img-fluid" width="672"></p>
</div>
</div>
</section>
<section id="slide-12-add-regression-line" class="level2">
<h2 class="anchored" data-anchor-id="slide-12-add-regression-line">Slide 12: Add regression line</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="co">#-----slide12----</span></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a>p  <span class="sc">+</span> <span class="fu">stat_smooth</span>(<span class="at">method=</span>lm, <span class="at">se=</span><span class="cn">FALSE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>`geom_smooth()` using formula = 'y ~ x'</code></pre>
</div>
<div class="cell-output-display">
<p><img src="Week3Lecture_files/figure-html/slide12-1.png" class="img-fluid" width="672"></p>
</div>
</div>
</section>
<section id="slide-13-14-linear-regression-model" class="level2">
<h2 class="anchored" data-anchor-id="slide-13-14-linear-regression-model">Slide 13 + 14: Linear regression model</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="co">#-----slide13+14----</span></span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a><span class="co"># fit model</span></span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a>nox.fit <span class="ot">&lt;-</span> <span class="fu">lm</span>(ln_nox <span class="sc">~</span> ln_no, <span class="at">data =</span> snapshot)</span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-6"><a href="#cb4-6" aria-hidden="true" tabindex="-1"></a><span class="co"># print summary, coefficients and CIs</span></span>
<span id="cb4-7"><a href="#cb4-7" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(nox.fit)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
lm(formula = ln_nox ~ ln_no, data = snapshot)

Residuals:
     Min       1Q   Median       3Q      Max 
-0.84114 -0.05533  0.00054  0.06672  1.63554 

Coefficients:
            Estimate Std. Error t value Pr(&gt;|t|)    
(Intercept) 2.215680   0.031943   69.36   &lt;2e-16 ***
ln_no       0.564922   0.009283   60.85   &lt;2e-16 ***
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

Residual standard error: 0.1832 on 447 degrees of freedom
Multiple R-squared:  0.8923,    Adjusted R-squared:  0.8921 
F-statistic:  3703 on 1 and 447 DF,  p-value: &lt; 2.2e-16</code></pre>
</div>
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="fu">coef</span>(nox.fit)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>(Intercept)       ln_no 
  2.2156798   0.5649221 </code></pre>
</div>
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="fu">confint</span>(nox.fit)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>               2.5 %    97.5 %
(Intercept) 2.152903 2.2784568
ln_no       0.546678 0.5831662</code></pre>
</div>
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="co"># variance-covariance matrix</span></span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a><span class="fu">vcov</span>(nox.fit)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>              (Intercept)         ln_no
(Intercept)  0.0010203520 -2.854654e-04
ln_no       -0.0002854654  8.617743e-05</code></pre>
</div>
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="co"># # "tidy" option for summary, coefficients, and CIs</span></span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a><span class="co"># from the broom package</span></span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a>summary_tbl <span class="ot">&lt;-</span> <span class="fu">tidy</span>(nox.fit, <span class="at">conf.int =</span> <span class="cn">TRUE</span>, <span class="at">conf.level =</span> <span class="fl">0.95</span>)</span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a>summary_tbl</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 2 × 7
  term        estimate std.error statistic   p.value conf.low conf.high
  &lt;chr&gt;          &lt;dbl&gt;     &lt;dbl&gt;     &lt;dbl&gt;     &lt;dbl&gt;    &lt;dbl&gt;     &lt;dbl&gt;
1 (Intercept)    2.22    0.0319       69.4 2.14e-241    2.15      2.28 
2 ln_no          0.565   0.00928      60.9 2.02e-218    0.547     0.583</code></pre>
</div>
</div>
</section>
<section id="slide-18" class="level2">
<h2 class="anchored" data-anchor-id="slide-18">Slide 18</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="co">#-----slide18----</span></span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Should be basic description of the factor variable.</span></span>
<span id="cb14-4"><a href="#cb14-4" aria-hidden="true" tabindex="-1"></a><span class="co"># season is the same variable as seasonfac, not as a factor and coded the same</span></span>
<span id="cb14-5"><a href="#cb14-5" aria-hidden="true" tabindex="-1"></a><span class="co"># 1,2,3. Verify this by looking at the data:</span></span>
<span id="cb14-6"><a href="#cb14-6" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(snapshot<span class="sc">$</span>seasonfac)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>1Summer   2Fall 3Winter 
    148     152     149 </code></pre>
</div>
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(snapshot<span class="sc">$</span>season)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>   Min. 1st Qu.  Median    Mean 3rd Qu.    Max. 
  1.000   1.000   2.000   2.002   3.000   3.000 </code></pre>
</div>
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a><span class="fu">table</span>(snapshot<span class="sc">$</span>season)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
  1   2   3 
148 152 149 </code></pre>
</div>
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a><span class="fu">table</span>(snapshot<span class="sc">$</span>seasonfac)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
1Summer   2Fall 3Winter 
    148     152     149 </code></pre>
</div>
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a><span class="fu">table</span>(snapshot<span class="sc">$</span>seasonfac,snapshot<span class="sc">$</span>season)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>         
            1   2   3
  1Summer 148   0   0
  2Fall     0 152   0
  3Winter   0   0 149</code></pre>
</div>
</div>
</section>
<section id="slide-19" class="level2">
<h2 class="anchored" data-anchor-id="slide-19">Slide 19</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a><span class="co">#-----slide19----</span></span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-3"><a href="#cb24-3" aria-hidden="true" tabindex="-1"></a>nox.aov<span class="ot">&lt;-</span><span class="fu">lm</span>(ln_nox <span class="sc">~</span> seasonfac, <span class="at">data =</span> snapshot)</span>
<span id="cb24-4"><a href="#cb24-4" aria-hidden="true" tabindex="-1"></a><span class="fu">anova</span>(nox.aov)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Analysis of Variance Table

Response: ln_nox
           Df Sum Sq Mean Sq F value    Pr(&gt;F)    
seasonfac   2 88.797  44.398  392.29 &lt; 2.2e-16 ***
Residuals 446 50.477   0.113                      
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</code></pre>
</div>
<div class="sourceCode cell-code" id="cb26"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(nox.aov)  </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
lm(formula = ln_nox ~ seasonfac, data = snapshot)

Residuals:
     Min       1Q   Median       3Q      Max 
-1.77479 -0.20277  0.04513  0.23392  0.97221 

Coefficients:
                 Estimate Std. Error t value Pr(&gt;|t|)    
(Intercept)       3.46913    0.02765  125.45   &lt;2e-16 ***
seasonfac2Fall    0.80043    0.03885   20.60   &lt;2e-16 ***
seasonfac3Winter  1.04536    0.03904   26.77   &lt;2e-16 ***
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

Residual standard error: 0.3364 on 446 degrees of freedom
Multiple R-squared:  0.6376,    Adjusted R-squared:  0.6359 
F-statistic: 392.3 on 2 and 446 DF,  p-value: &lt; 2.2e-16</code></pre>
</div>
<div class="sourceCode cell-code" id="cb28"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a><span class="co">#model.matrix(nox.aov)</span></span>
<span id="cb28-2"><a href="#cb28-2" aria-hidden="true" tabindex="-1"></a><span class="fu">margin.table</span>(<span class="fu">model.matrix</span>(nox.aov), <span class="dv">2</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>     (Intercept)   seasonfac2Fall seasonfac3Winter 
             449              152              149 </code></pre>
</div>
</div>
</section>
<section id="slide-20-add-means-of-ln_nox-by-season" class="level2">
<h2 class="anchored" data-anchor-id="slide-20-add-means-of-ln_nox-by-season">Slide 20: add means of ln_nox by season</h2>
<p>For example of interpreting dummy variables</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb30"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a><span class="co">#-----slide20----</span></span>
<span id="cb30-2"><a href="#cb30-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-3"><a href="#cb30-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Simple row of means of ln_nox by season</span></span>
<span id="cb30-4"><a href="#cb30-4" aria-hidden="true" tabindex="-1"></a><span class="fu">round</span>(<span class="fu">tapply</span>(snapshot<span class="sc">$</span>ln_nox, snapshot<span class="sc">$</span>seasonfac, mean), <span class="dv">2</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>1Summer   2Fall 3Winter 
   3.47    4.27    4.51 </code></pre>
</div>
<div class="sourceCode cell-code" id="cb32"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a><span class="co"># # dplyr option (same results, output is formatted differently)</span></span>
<span id="cb32-2"><a href="#cb32-2" aria-hidden="true" tabindex="-1"></a>snapshot <span class="sc">%&gt;%</span> </span>
<span id="cb32-3"><a href="#cb32-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">group_by</span>(seasonfac) <span class="sc">%&gt;%</span> </span>
<span id="cb32-4"><a href="#cb32-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">summarise</span>(<span class="fu">mean</span>(ln_nox), <span class="at">.groups =</span> <span class="st">"drop"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb32-5"><a href="#cb32-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate_if</span>(is.numeric, round, <span class="dv">2</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 3 × 2
  seasonfac `mean(ln_nox)`
  &lt;fct&gt;              &lt;dbl&gt;
1 1Summer             3.47
2 2Fall               4.27
3 3Winter             4.51</code></pre>
</div>
<div class="sourceCode cell-code" id="cb34"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a><span class="co"># full table of N, means &amp; sd of ln_nox by season, dplyr option</span></span>
<span id="cb34-2"><a href="#cb34-2" aria-hidden="true" tabindex="-1"></a>snapshot <span class="sc">%&gt;%</span></span>
<span id="cb34-3"><a href="#cb34-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">group_by</span>(seasonfac) <span class="sc">%&gt;%</span></span>
<span id="cb34-4"><a href="#cb34-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">summarise</span>(<span class="at">N =</span> <span class="fu">n</span>(), </span>
<span id="cb34-5"><a href="#cb34-5" aria-hidden="true" tabindex="-1"></a>              <span class="at">mean =</span> <span class="fu">mean</span>(ln_nox),</span>
<span id="cb34-6"><a href="#cb34-6" aria-hidden="true" tabindex="-1"></a>              <span class="at">sd =</span> <span class="fu">sd</span>(ln_nox), </span>
<span id="cb34-7"><a href="#cb34-7" aria-hidden="true" tabindex="-1"></a>              <span class="at">.groups =</span> <span class="st">"drop"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb34-8"><a href="#cb34-8" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate_if</span>(is.double, round, <span class="dv">2</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 3 × 4
  seasonfac     N  mean    sd
  &lt;fct&gt;     &lt;int&gt; &lt;dbl&gt; &lt;dbl&gt;
1 1Summer     148  3.47  0.39
2 2Fall       152  4.27  0.32
3 3Winter     149  4.51  0.3 </code></pre>
</div>
</div>
</section>
<section id="slide-21-be-aware-of-coding" class="level2">
<h2 class="anchored" data-anchor-id="slide-21-be-aware-of-coding">Slide 21: Be aware of coding!</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb36"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb36-1"><a href="#cb36-1" aria-hidden="true" tabindex="-1"></a><span class="co">#-----slide21----</span></span>
<span id="cb36-2"><a href="#cb36-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-3"><a href="#cb36-3" aria-hidden="true" tabindex="-1"></a>nox.aov2<span class="ot">&lt;-</span><span class="fu">lm</span>(ln_nox<span class="sc">~</span>season, <span class="at">data=</span>snapshot)</span>
<span id="cb36-4"><a href="#cb36-4" aria-hidden="true" tabindex="-1"></a><span class="fu">anova</span>(nox.aov2)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Analysis of Variance Table

Response: ln_nox
           Df Sum Sq Mean Sq F value    Pr(&gt;F)    
season      1 81.040   81.04  622.07 &lt; 2.2e-16 ***
Residuals 447 58.233    0.13                      
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</code></pre>
</div>
<div class="sourceCode cell-code" id="cb38"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb38-1"><a href="#cb38-1" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(nox.aov2)  </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
lm(formula = ln_nox ~ season, data = snapshot)

Residuals:
     Min       1Q   Median       3Q      Max 
-1.86913 -0.20422  0.00437  0.23548  0.91107 

Coefficients:
            Estimate Std. Error t value Pr(&gt;|t|)    
(Intercept)  3.04111    0.04526   67.19   &lt;2e-16 ***
season       0.52237    0.02094   24.94   &lt;2e-16 ***
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

Residual standard error: 0.3609 on 447 degrees of freedom
Multiple R-squared:  0.5819,    Adjusted R-squared:  0.5809 
F-statistic: 622.1 on 1 and 447 DF,  p-value: &lt; 2.2e-16</code></pre>
</div>
</div>
</section>
<section id="slide-22-season-stratified-analysis-example-means-of-ln_nox-ln_no-by-season" class="level2">
<h2 class="anchored" data-anchor-id="slide-22-season-stratified-analysis-example-means-of-ln_nox-ln_no-by-season">Slide 22: Season-stratified analysis example: means of ln_nox, ln_no by season</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb40"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb40-1"><a href="#cb40-1" aria-hidden="true" tabindex="-1"></a><span class="co">#-----define summary function----</span></span>
<span id="cb40-2"><a href="#cb40-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-3"><a href="#cb40-3" aria-hidden="true" tabindex="-1"></a>summary_stats <span class="ot">&lt;-</span> <span class="cf">function</span>(<span class="at">df =</span> snapshot, summary_var, <span class="at">grouping_var =</span> seasonfac, </span>
<span id="cb40-4"><a href="#cb40-4" aria-hidden="true" tabindex="-1"></a>                          <span class="at">digits =</span> <span class="dv">2</span>){</span>
<span id="cb40-5"><a href="#cb40-5" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb40-6"><a href="#cb40-6" aria-hidden="true" tabindex="-1"></a>  <span class="co"># specify names &amp; variables for non-standard evaluation</span></span>
<span id="cb40-7"><a href="#cb40-7" aria-hidden="true" tabindex="-1"></a>  grouping_var <span class="ot">&lt;-</span> <span class="fu">enquo</span>(grouping_var)</span>
<span id="cb40-8"><a href="#cb40-8" aria-hidden="true" tabindex="-1"></a>  summary_var <span class="ot">&lt;-</span> <span class="fu">enquo</span>(summary_var)</span>
<span id="cb40-9"><a href="#cb40-9" aria-hidden="true" tabindex="-1"></a>  summary_name <span class="ot">&lt;-</span> <span class="fu">quo_name</span>(summary_var)</span>
<span id="cb40-10"><a href="#cb40-10" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb40-11"><a href="#cb40-11" aria-hidden="true" tabindex="-1"></a>  <span class="co"># create names for summary stats</span></span>
<span id="cb40-12"><a href="#cb40-12" aria-hidden="true" tabindex="-1"></a>  summary_name_N <span class="ot">&lt;-</span> <span class="fu">paste0</span>(summary_name, <span class="st">".N"</span>)</span>
<span id="cb40-13"><a href="#cb40-13" aria-hidden="true" tabindex="-1"></a>  summary_name_mean <span class="ot">&lt;-</span> <span class="fu">paste0</span>(summary_name, <span class="st">".mean"</span>)</span>
<span id="cb40-14"><a href="#cb40-14" aria-hidden="true" tabindex="-1"></a>  summary_name_sd <span class="ot">&lt;-</span> <span class="fu">paste0</span>(summary_name, <span class="st">".sd"</span>)</span>
<span id="cb40-15"><a href="#cb40-15" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb40-16"><a href="#cb40-16" aria-hidden="true" tabindex="-1"></a>  <span class="co"># create summary</span></span>
<span id="cb40-17"><a href="#cb40-17" aria-hidden="true" tabindex="-1"></a>  df <span class="sc">%&gt;%</span></span>
<span id="cb40-18"><a href="#cb40-18" aria-hidden="true" tabindex="-1"></a>    <span class="fu">group_by</span>(<span class="sc">!!</span>grouping_var) <span class="sc">%&gt;%</span> </span>
<span id="cb40-19"><a href="#cb40-19" aria-hidden="true" tabindex="-1"></a>    <span class="fu">summarise</span>(<span class="sc">!!</span><span class="at">summary_name_N :=</span> <span class="fu">n</span>(), </span>
<span id="cb40-20"><a href="#cb40-20" aria-hidden="true" tabindex="-1"></a>              <span class="sc">!!</span><span class="at">summary_name_mean :=</span> <span class="fu">mean</span>(<span class="sc">!!</span>summary_var), </span>
<span id="cb40-21"><a href="#cb40-21" aria-hidden="true" tabindex="-1"></a>              <span class="sc">!!</span><span class="at">summary_name_sd :=</span> <span class="fu">sd</span>(<span class="sc">!!</span>summary_var), </span>
<span id="cb40-22"><a href="#cb40-22" aria-hidden="true" tabindex="-1"></a>              <span class="at">.groups =</span> <span class="st">"drop"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb40-23"><a href="#cb40-23" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate_if</span>(is.double, round, digits)</span>
<span id="cb40-24"><a href="#cb40-24" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb41"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb41-1"><a href="#cb41-1" aria-hidden="true" tabindex="-1"></a><span class="co">#-----slide22-------------------------</span></span>
<span id="cb41-2"><a href="#cb41-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-3"><a href="#cb41-3" aria-hidden="true" tabindex="-1"></a><span class="co"># ln_nox</span></span>
<span id="cb41-4"><a href="#cb41-4" aria-hidden="true" tabindex="-1"></a><span class="fu">summary_stats</span>(<span class="at">summary_var =</span> ln_nox)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 3 × 4
  seasonfac ln_nox.N ln_nox.mean ln_nox.sd
  &lt;fct&gt;        &lt;int&gt;       &lt;dbl&gt;     &lt;dbl&gt;
1 1Summer        148        3.47      0.39
2 2Fall          152        4.27      0.32
3 3Winter        149        4.51      0.3 </code></pre>
</div>
<div class="sourceCode cell-code" id="cb43"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb43-1"><a href="#cb43-1" aria-hidden="true" tabindex="-1"></a><span class="co"># ln_no</span></span>
<span id="cb43-2"><a href="#cb43-2" aria-hidden="true" tabindex="-1"></a><span class="fu">summary_stats</span>(<span class="at">summary_var =</span> ln_no)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 3 × 4
  seasonfac ln_no.N ln_no.mean ln_no.sd
  &lt;fct&gt;       &lt;int&gt;      &lt;dbl&gt;    &lt;dbl&gt;
1 1Summer       148       2.22     0.58
2 2Fall         152       3.65     0.5 
3 3Winter       149       4.06     0.42</code></pre>
</div>
<div class="sourceCode cell-code" id="cb45"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb45-1"><a href="#cb45-1" aria-hidden="true" tabindex="-1"></a><span class="co"># ln_nox and ln_no</span></span>
<span id="cb45-2"><a href="#cb45-2" aria-hidden="true" tabindex="-1"></a><span class="fu">full_join</span>(<span class="fu">summary_stats</span>(<span class="at">summary_var =</span> ln_nox), </span>
<span id="cb45-3"><a href="#cb45-3" aria-hidden="true" tabindex="-1"></a>          <span class="fu">summary_stats</span>(<span class="at">summary_var =</span> ln_no), </span>
<span id="cb45-4"><a href="#cb45-4" aria-hidden="true" tabindex="-1"></a>          <span class="at">by =</span> <span class="st">"seasonfac"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 3 × 7
  seasonfac ln_nox.N ln_nox.mean ln_nox.sd ln_no.N ln_no.mean ln_no.sd
  &lt;fct&gt;        &lt;int&gt;       &lt;dbl&gt;     &lt;dbl&gt;   &lt;int&gt;      &lt;dbl&gt;    &lt;dbl&gt;
1 1Summer        148        3.47      0.39     148       2.22     0.58
2 2Fall          152        4.27      0.32     152       3.65     0.5 
3 3Winter        149        4.51      0.3      149       4.06     0.42</code></pre>
</div>
</div>
</section>
<section id="slide-23-scatterplot-with-3-season-specific-lines" class="level2">
<h2 class="anchored" data-anchor-id="slide-23-scatterplot-with-3-season-specific-lines">Slide 23: Scatterplot with 3 season-specific lines</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb47"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb47-1"><a href="#cb47-1" aria-hidden="true" tabindex="-1"></a><span class="co">#-----slide23----</span></span>
<span id="cb47-2"><a href="#cb47-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-3"><a href="#cb47-3" aria-hidden="true" tabindex="-1"></a><span class="co"># ggplot with separate colors and lines by season</span></span>
<span id="cb47-4"><a href="#cb47-4" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(snapshot, <span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">x =</span> ln_no, <span class="at">y =</span> ln_nox, <span class="at">color =</span> seasonfac)) <span class="sc">+</span></span>
<span id="cb47-5"><a href="#cb47-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_point</span>(<span class="at">alpha =</span> .<span class="dv">4</span>, <span class="at">size=</span>.<span class="dv">7</span>) <span class="sc">+</span></span>
<span id="cb47-6"><a href="#cb47-6" aria-hidden="true" tabindex="-1"></a>    <span class="fu">stat_smooth</span>(<span class="at">method =</span> lm, <span class="at">se=</span><span class="cn">FALSE</span>) <span class="sc">+</span></span>
<span id="cb47-7"><a href="#cb47-7" aria-hidden="true" tabindex="-1"></a>    <span class="co">#geom_rug(position="jitter", size=.2) +</span></span>
<span id="cb47-8"><a href="#cb47-8" aria-hidden="true" tabindex="-1"></a>    <span class="fu">xlim</span>(<span class="fu">range</span>(snapshot<span class="sc">$</span>ln_no, snapshot<span class="sc">$</span>ln_nox)) <span class="sc">+</span></span>
<span id="cb47-9"><a href="#cb47-9" aria-hidden="true" tabindex="-1"></a>    <span class="fu">ylim</span>(<span class="fu">range</span>(snapshot<span class="sc">$</span>ln_no, snapshot<span class="sc">$</span>ln_nox)) <span class="sc">+</span></span>
<span id="cb47-10"><a href="#cb47-10" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_abline</span>(<span class="at">slope =</span> <span class="dv">1</span>, <span class="at">intercept =</span> <span class="dv">0</span>, <span class="at">alpha =</span> .<span class="dv">2</span>, <span class="at">color =</span> <span class="st">"black"</span>) <span class="sc">+</span></span>
<span id="cb47-11"><a href="#cb47-11" aria-hidden="true" tabindex="-1"></a>    <span class="fu">coord_fixed</span>() <span class="sc">+</span></span>
<span id="cb47-12"><a href="#cb47-12" aria-hidden="true" tabindex="-1"></a>    <span class="fu">labs</span>(<span class="at">x=</span><span class="st">"ln(NO) (ln(ppb))"</span>, <span class="at">y=</span><span class="st">"ln(NOx) (ln(ppb)"</span>, <span class="at">color=</span><span class="st">"Season"</span>) <span class="sc">+</span> </span>
<span id="cb47-13"><a href="#cb47-13" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme_bw</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="Week3Lecture_files/figure-html/slide23-1.png" class="img-fluid" width="672"></p>
</div>
</div>
</section>
<section id="slide-25-season-specific-regression" class="level2">
<h2 class="anchored" data-anchor-id="slide-25-season-specific-regression">Slide 25: Season-specific regression</h2>
<p>Summarize each season-specific model</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb48"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb48-1"><a href="#cb48-1" aria-hidden="true" tabindex="-1"></a><span class="co">#-----slide25----</span></span>
<span id="cb48-2"><a href="#cb48-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-3"><a href="#cb48-3" aria-hidden="true" tabindex="-1"></a><span class="co"># season-specific regressions, as shown on slide (only subset of output)</span></span>
<span id="cb48-4"><a href="#cb48-4" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(<span class="fu">lm</span>(ln_nox <span class="sc">~</span> ln_no, <span class="at">data =</span> snapshot, <span class="at">subset =</span> seasonfac <span class="sc">==</span> <span class="st">"1Summer"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
lm(formula = ln_nox ~ ln_no, data = snapshot, subset = seasonfac == 
    "1Summer")

Residuals:
     Min       1Q   Median       3Q      Max 
-0.96001 -0.09415  0.00218  0.15193  1.30632 

Coefficients:
            Estimate Std. Error t value Pr(&gt;|t|)    
(Intercept)  2.50219    0.09506   26.32   &lt;2e-16 ***
ln_no        0.43544    0.04141   10.52   &lt;2e-16 ***
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

Residual standard error: 0.2932 on 146 degrees of freedom
Multiple R-squared:  0.431, Adjusted R-squared:  0.4271 
F-statistic: 110.6 on 1 and 146 DF,  p-value: &lt; 2.2e-16</code></pre>
</div>
<div class="sourceCode cell-code" id="cb50"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb50-1"><a href="#cb50-1" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(<span class="fu">lm</span>(ln_nox <span class="sc">~</span> ln_no, <span class="at">data =</span> snapshot, <span class="at">subset =</span> seasonfac <span class="sc">==</span> <span class="st">"2Fall"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
lm(formula = ln_nox ~ ln_no, data = snapshot, subset = seasonfac == 
    "2Fall")

Residuals:
      Min        1Q    Median        3Q       Max 
-0.172004 -0.032667 -0.000707  0.035451  0.298811 

Coefficients:
            Estimate Std. Error t value Pr(&gt;|t|)    
(Intercept)  2.00416    0.03924   51.07   &lt;2e-16 ***
ln_no        0.62102    0.01066   58.26   &lt;2e-16 ***
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

Residual standard error: 0.06551 on 150 degrees of freedom
Multiple R-squared:  0.9577,    Adjusted R-squared:  0.9574 
F-statistic:  3394 on 1 and 150 DF,  p-value: &lt; 2.2e-16</code></pre>
</div>
<div class="sourceCode cell-code" id="cb52"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb52-1"><a href="#cb52-1" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(<span class="fu">lm</span>(ln_nox <span class="sc">~</span> ln_no, <span class="at">data =</span> snapshot, <span class="at">subset =</span> seasonfac <span class="sc">==</span> <span class="st">"3Winter"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
lm(formula = ln_nox ~ ln_no, data = snapshot, subset = seasonfac == 
    "3Winter")

Residuals:
     Min       1Q   Median       3Q      Max 
-0.12209 -0.02501  0.00524  0.02654  0.14184 

Coefficients:
            Estimate Std. Error t value Pr(&gt;|t|)    
(Intercept) 1.647180   0.036554   45.06   &lt;2e-16 ***
ln_no       0.707100   0.008967   78.85   &lt;2e-16 ***
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

Residual standard error: 0.04555 on 147 degrees of freedom
Multiple R-squared:  0.9769,    Adjusted R-squared:  0.9767 
F-statistic:  6218 on 1 and 147 DF,  p-value: &lt; 2.2e-16</code></pre>
</div>
</div>
<p>Here’s an alternative way to code the season-specific modeling approach using tidyverse. This allows you to run the regressions for each group in one command. More code, but these are coding ideas that will generalize to future settings where the number of subsets would make this a much more sensible approach.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb54"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb54-1"><a href="#cb54-1" aria-hidden="true" tabindex="-1"></a><span class="co">#----slide25.dplyr----</span></span>
<span id="cb54-2"><a href="#cb54-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-3"><a href="#cb54-3" aria-hidden="true" tabindex="-1"></a><span class="co"># # dplyr option </span></span>
<span id="cb54-4"><a href="#cb54-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Need to load the broom, purrr, &amp; tidyr packages for this approach</span></span>
<span id="cb54-5"><a href="#cb54-5" aria-hidden="true" tabindex="-1"></a>season_mdls <span class="ot">&lt;-</span> snapshot <span class="sc">%&gt;%</span> </span>
<span id="cb54-6"><a href="#cb54-6" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb54-7"><a href="#cb54-7" aria-hidden="true" tabindex="-1"></a>  <span class="co"># group by season</span></span>
<span id="cb54-8"><a href="#cb54-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(seasonfac) <span class="sc">%&gt;%</span></span>
<span id="cb54-9"><a href="#cb54-9" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb54-10"><a href="#cb54-10" aria-hidden="true" tabindex="-1"></a>  <span class="co"># nest the tibble</span></span>
<span id="cb54-11"><a href="#cb54-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">nest</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb54-12"><a href="#cb54-12" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb54-13"><a href="#cb54-13" aria-hidden="true" tabindex="-1"></a>  <span class="co"># run regression model for each group, clean up with `tidy()`</span></span>
<span id="cb54-14"><a href="#cb54-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">model =</span> <span class="fu">map</span>(data, <span class="sc">~</span><span class="fu">lm</span>(ln_nox <span class="sc">~</span> ln_no, <span class="at">data =</span> .x)),</span>
<span id="cb54-15"><a href="#cb54-15" aria-hidden="true" tabindex="-1"></a>         <span class="at">summary =</span> <span class="fu">map</span>(model, summary),</span>
<span id="cb54-16"><a href="#cb54-16" aria-hidden="true" tabindex="-1"></a>         <span class="at">tidied =</span> <span class="fu">map</span>(model, tidy) </span>
<span id="cb54-17"><a href="#cb54-17" aria-hidden="true" tabindex="-1"></a>         ) <span class="sc">%&gt;%</span> </span>
<span id="cb54-18"><a href="#cb54-18" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb54-19"><a href="#cb54-19" aria-hidden="true" tabindex="-1"></a>  <span class="co"># unnest</span></span>
<span id="cb54-20"><a href="#cb54-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">unnest</span>(tidied)</span>
<span id="cb54-21"><a href="#cb54-21" aria-hidden="true" tabindex="-1"></a> </span>
<span id="cb54-22"><a href="#cb54-22" aria-hidden="true" tabindex="-1"></a><span class="co"># show seasonal model summaries</span></span>
<span id="cb54-23"><a href="#cb54-23" aria-hidden="true" tabindex="-1"></a>season_mdls<span class="sc">$</span>summary <span class="sc">%&gt;%</span> <span class="fu">unique</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[[1]]

Call:
lm(formula = ln_nox ~ ln_no, data = .x)

Residuals:
     Min       1Q   Median       3Q      Max 
-0.96001 -0.09415  0.00218  0.15193  1.30632 

Coefficients:
            Estimate Std. Error t value Pr(&gt;|t|)    
(Intercept)  2.50219    0.09506   26.32   &lt;2e-16 ***
ln_no        0.43544    0.04141   10.52   &lt;2e-16 ***
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

Residual standard error: 0.2932 on 146 degrees of freedom
Multiple R-squared:  0.431, Adjusted R-squared:  0.4271 
F-statistic: 110.6 on 1 and 146 DF,  p-value: &lt; 2.2e-16


[[2]]

Call:
lm(formula = ln_nox ~ ln_no, data = .x)

Residuals:
      Min        1Q    Median        3Q       Max 
-0.172004 -0.032667 -0.000707  0.035451  0.298811 

Coefficients:
            Estimate Std. Error t value Pr(&gt;|t|)    
(Intercept)  2.00416    0.03924   51.07   &lt;2e-16 ***
ln_no        0.62102    0.01066   58.26   &lt;2e-16 ***
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

Residual standard error: 0.06551 on 150 degrees of freedom
Multiple R-squared:  0.9577,    Adjusted R-squared:  0.9574 
F-statistic:  3394 on 1 and 150 DF,  p-value: &lt; 2.2e-16


[[3]]

Call:
lm(formula = ln_nox ~ ln_no, data = .x)

Residuals:
     Min       1Q   Median       3Q      Max 
-0.12209 -0.02501  0.00524  0.02654  0.14184 

Coefficients:
            Estimate Std. Error t value Pr(&gt;|t|)    
(Intercept) 1.647180   0.036554   45.06   &lt;2e-16 ***
ln_no       0.707100   0.008967   78.85   &lt;2e-16 ***
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

Residual standard error: 0.04555 on 147 degrees of freedom
Multiple R-squared:  0.9769,    Adjusted R-squared:  0.9767 
F-statistic:  6218 on 1 and 147 DF,  p-value: &lt; 2.2e-16</code></pre>
</div>
</div>
</section>
<section id="slide-26-season-adjusted-regression" class="level2">
<h2 class="anchored" data-anchor-id="slide-26-season-adjusted-regression">Slide 26: Season-adjusted regression</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb56"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb56-1"><a href="#cb56-1" aria-hidden="true" tabindex="-1"></a><span class="co">#-----slide26 season adjusted----</span></span>
<span id="cb56-2"><a href="#cb56-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb56-3"><a href="#cb56-3" aria-hidden="true" tabindex="-1"></a><span class="co"># season-adjusted regression</span></span>
<span id="cb56-4"><a href="#cb56-4" aria-hidden="true" tabindex="-1"></a>nox.fit.seasadj <span class="ot">&lt;-</span><span class="fu">lm</span>(ln_nox <span class="sc">~</span> ln_no <span class="sc">+</span> seasonfac, <span class="at">data =</span> snapshot)</span>
<span id="cb56-5"><a href="#cb56-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb56-6"><a href="#cb56-6" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(nox.fit.seasadj)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
lm(formula = ln_nox ~ ln_no + seasonfac, data = snapshot)

Residuals:
     Min       1Q   Median       3Q      Max 
-0.84378 -0.05616  0.00276  0.06878  1.62058 

Coefficients:
                 Estimate Std. Error t value Pr(&gt;|t|)    
(Intercept)      2.228426   0.041074  54.253   &lt;2e-16 ***
ln_no            0.558718   0.017205  32.474   &lt;2e-16 ***
seasonfac2Fall   0.003014   0.032432   0.093    0.926    
seasonfac3Winter 0.020451   0.038071   0.537    0.591    
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

Residual standard error: 0.1835 on 445 degrees of freedom
Multiple R-squared:  0.8924,    Adjusted R-squared:  0.8917 
F-statistic:  1231 on 3 and 445 DF,  p-value: &lt; 2.2e-16</code></pre>
</div>
<div class="sourceCode cell-code" id="cb58"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb58-1"><a href="#cb58-1" aria-hidden="true" tabindex="-1"></a><span class="fu">confint</span>(nox.fit.seasadj)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>                       2.5 %     97.5 %
(Intercept)       2.14770200 2.30915004
ln_no             0.52490457 0.59253047
seasonfac2Fall   -0.06072550 0.06675330
seasonfac3Winter -0.05437144 0.09527248</code></pre>
</div>
</div>
</section>
<section id="slide-27-be-aware-of-coding" class="level2">
<h2 class="anchored" data-anchor-id="slide-27-be-aware-of-coding">Slide 27: Be aware of coding!</h2>
<p>Season as a continuous variable</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb60"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb60-1"><a href="#cb60-1" aria-hidden="true" tabindex="-1"></a><span class="co">#-----slide27----</span></span>
<span id="cb60-2"><a href="#cb60-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-3"><a href="#cb60-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Season as a continuous variable</span></span>
<span id="cb60-4"><a href="#cb60-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-5"><a href="#cb60-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Fit the linear regression with continuous season variable</span></span>
<span id="cb60-6"><a href="#cb60-6" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(<span class="fu">lm</span>(ln_nox <span class="sc">~</span> ln_no <span class="sc">+</span> season, <span class="at">data =</span> snapshot))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
lm(formula = ln_nox ~ ln_no + season, data = snapshot)

Residuals:
     Min       1Q   Median       3Q      Max 
-0.84335 -0.05576  0.00133  0.06747  1.61576 

Coefficients:
            Estimate Std. Error t value Pr(&gt;|t|)    
(Intercept)  2.21965    0.03244  68.420   &lt;2e-16 ***
ln_no        0.55607    0.01550  35.880   &lt;2e-16 ***
season       0.01266    0.01775   0.713    0.476    
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

Residual standard error: 0.1833 on 446 degrees of freedom
Multiple R-squared:  0.8924,    Adjusted R-squared:  0.8919 
F-statistic:  1850 on 2 and 446 DF,  p-value: &lt; 2.2e-16</code></pre>
</div>
<div class="sourceCode cell-code" id="cb62"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb62-1"><a href="#cb62-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Compare to the regression on the previous slide</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="slide-29-interaction-model" class="level2">
<h2 class="anchored" data-anchor-id="slide-29-interaction-model">Slide 29: Interaction model</h2>
<p>Need to load the <code>car</code> package for the <code>linearHypothesis</code> command. It masks at least one object from several other packages, so don’t load if you don’t need it. You can explicitly tell R which package to use with the “packagename::” prefix to a function or object.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb63"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb63-1"><a href="#cb63-1" aria-hidden="true" tabindex="-1"></a><span class="co">#-----slide29----</span></span>
<span id="cb63-2"><a href="#cb63-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb63-3"><a href="#cb63-3" aria-hidden="true" tabindex="-1"></a><span class="co"># interaction model</span></span>
<span id="cb63-4"><a href="#cb63-4" aria-hidden="true" tabindex="-1"></a>snap_int <span class="ot">&lt;-</span> <span class="fu">lm</span>(ln_nox <span class="sc">~</span> ln_no <span class="sc">*</span> seasonfac, <span class="at">data =</span> snapshot)</span>
<span id="cb63-5"><a href="#cb63-5" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(snap_int)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
lm(formula = ln_nox ~ ln_no * seasonfac, data = snapshot)

Residuals:
     Min       1Q   Median       3Q      Max 
-0.96001 -0.04317  0.00148  0.04709  1.30632 

Coefficients:
                       Estimate Std. Error t value Pr(&gt;|t|)    
(Intercept)             2.50219    0.05660  44.209  &lt; 2e-16 ***
ln_no                   0.43544    0.02465  17.661  &lt; 2e-16 ***
seasonfac2Fall         -0.49803    0.11891  -4.188 3.40e-05 ***
seasonfac3Winter       -0.85501    0.15111  -5.658 2.75e-08 ***
ln_no:seasonfac2Fall    0.18559    0.03761   4.934 1.14e-06 ***
ln_no:seasonfac3Winter  0.27166    0.04230   6.422 3.47e-10 ***
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

Residual standard error: 0.1746 on 443 degrees of freedom
Multiple R-squared:  0.9031,    Adjusted R-squared:  0.902 
F-statistic: 825.3 on 5 and 443 DF,  p-value: &lt; 2.2e-16</code></pre>
</div>
<div class="sourceCode cell-code" id="cb65"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb65-1"><a href="#cb65-1" aria-hidden="true" tabindex="-1"></a><span class="co"># F test for significant interaction from the car package</span></span>
<span id="cb65-2"><a href="#cb65-2" aria-hidden="true" tabindex="-1"></a><span class="fu">linearHypothesis</span>(snap_int, <span class="fu">c</span>(<span class="st">"ln_no:seasonfac2Fall=0"</span>, <span class="st">"ln_no:seasonfac3Winter=0"</span>), </span>
<span id="cb65-3"><a href="#cb65-3" aria-hidden="true" tabindex="-1"></a>                 <span class="at">test=</span><span class="st">"F"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Linear hypothesis test

Hypothesis:
ln_no:seasonfac2Fall = 0
ln_no:seasonfac3Winter = 0

Model 1: restricted model
Model 2: ln_nox ~ ln_no * seasonfac

  Res.Df    RSS Df Sum of Sq      F    Pr(&gt;F)    
1    445 14.979                                  
2    443 13.502  2    1.4767 24.225 1.037e-10 ***
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</code></pre>
</div>
</div>
</section>
<section id="slide-30-lincom-coeficient-estimates" class="level2">
<h2 class="anchored" data-anchor-id="slide-30-lincom-coeficient-estimates">Slide 30: “lincom” coeficient estimates</h2>
<p>Note: This can be done using the <code>glht</code> command from the <code>multcomp</code> package. This will mask several objects from other packages including <code>select</code> from <code>dplyr</code>, and <code>boxcox</code> from <code>EnvStats</code>.</p>
<p>Here is an example I found online:</p>
<pre><code># mod is the output of a lm
# Extract the coefficient names (b0,b1,b2,b3)
names(coef(mod))  
# linfct specifies the required combination In this case we want b1+b3=0
# (effect of gender in age&gt;40)
summary(glht(mod, linfct = c("genderMale + genderMale:agehiTRUE = 0")))
# Show the confidence interval
mod.lh &lt;- glht(mod, linfct = c("genderMale + genderMale:agehiTRUE = 0"))
confint(mod.lh)
</code></pre>
<div class="cell">
<div class="sourceCode cell-code" id="cb68"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb68-1"><a href="#cb68-1" aria-hidden="true" tabindex="-1"></a><span class="co">#-----find means----</span></span>
<span id="cb68-2"><a href="#cb68-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb68-3"><a href="#cb68-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Note:  this does not require snapshot to be a tibble</span></span>
<span id="cb68-4"><a href="#cb68-4" aria-hidden="true" tabindex="-1"></a>snapshot <span class="sc">%&gt;%</span></span>
<span id="cb68-5"><a href="#cb68-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">group_by</span>(seasonfac) <span class="sc">%&gt;%</span></span>
<span id="cb68-6"><a href="#cb68-6" aria-hidden="true" tabindex="-1"></a>    <span class="fu">summarise</span>(<span class="at">N =</span> <span class="fu">length</span>(ln_nox), </span>
<span id="cb68-7"><a href="#cb68-7" aria-hidden="true" tabindex="-1"></a>              <span class="at">ln_no_mean =</span> <span class="fu">mean</span>(ln_no),</span>
<span id="cb68-8"><a href="#cb68-8" aria-hidden="true" tabindex="-1"></a>              <span class="at">ln_nox_mean =</span> <span class="fu">mean</span>(ln_nox),</span>
<span id="cb68-9"><a href="#cb68-9" aria-hidden="true" tabindex="-1"></a>              <span class="at">ln_nox_sd =</span> <span class="fu">sd</span>(ln_nox),</span>
<span id="cb68-10"><a href="#cb68-10" aria-hidden="true" tabindex="-1"></a>              <span class="at">ln_nox_LCI =</span> ln_nox_mean <span class="sc">-</span> <span class="fl">1.96</span><span class="sc">*</span>ln_nox_sd <span class="sc">/</span> <span class="fu">sqrt</span>(N),</span>
<span id="cb68-11"><a href="#cb68-11" aria-hidden="true" tabindex="-1"></a>              <span class="at">ln_nox_UCI =</span> ln_nox_mean <span class="sc">+</span> <span class="fl">1.96</span><span class="sc">*</span>ln_nox_sd <span class="sc">/</span> <span class="fu">sqrt</span>(N) </span>
<span id="cb68-12"><a href="#cb68-12" aria-hidden="true" tabindex="-1"></a>              )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 3 × 7
  seasonfac     N ln_no_mean ln_nox_mean ln_nox_sd ln_nox_LCI ln_nox_UCI
  &lt;fct&gt;     &lt;int&gt;      &lt;dbl&gt;       &lt;dbl&gt;     &lt;dbl&gt;      &lt;dbl&gt;      &lt;dbl&gt;
1 1Summer     148       2.22        3.47     0.387       3.41       3.53
2 2Fall       152       3.65        4.27     0.317       4.22       4.32
3 3Winter     149       4.06        4.51     0.299       4.47       4.56</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb70"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb70-1"><a href="#cb70-1" aria-hidden="true" tabindex="-1"></a><span class="co">#-----slide30 lincom example----</span></span>
<span id="cb70-2"><a href="#cb70-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-3"><a href="#cb70-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Estimate the mean ln(NOx) when ln(NO) is 4</span></span>
<span id="cb70-4"><a href="#cb70-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-5"><a href="#cb70-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Show the coefficient names.  Their order is needed for the K matrix definition</span></span>
<span id="cb70-6"><a href="#cb70-6" aria-hidden="true" tabindex="-1"></a><span class="co"># so we know which values go in which column</span></span>
<span id="cb70-7"><a href="#cb70-7" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(<span class="fu">coef</span>(snap_int))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "(Intercept)"            "ln_no"                  "seasonfac2Fall"        
[4] "seasonfac3Winter"       "ln_no:seasonfac2Fall"   "ln_no:seasonfac3Winter"</code></pre>
</div>
<div class="sourceCode cell-code" id="cb72"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb72-1"><a href="#cb72-1" aria-hidden="true" tabindex="-1"></a><span class="co"># K is the matrix of contrasts of interest to create the linear combination of</span></span>
<span id="cb72-2"><a href="#cb72-2" aria-hidden="true" tabindex="-1"></a><span class="co"># the coefficients times the values in K.  Each row is for a contrast of</span></span>
<span id="cb72-3"><a href="#cb72-3" aria-hidden="true" tabindex="-1"></a><span class="co"># interest.  The values in the rows are ordered by the coefficients. First row</span></span>
<span id="cb72-4"><a href="#cb72-4" aria-hidden="true" tabindex="-1"></a><span class="co"># is summer when ln_no is 4, then same question for fall, then winter</span></span>
<span id="cb72-5"><a href="#cb72-5" aria-hidden="true" tabindex="-1"></a>K <span class="ot">&lt;-</span> <span class="fu">rbind</span>(<span class="at">summer =</span> <span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">4</span>,<span class="dv">0</span>,<span class="dv">0</span>,<span class="dv">0</span>,<span class="dv">0</span>),</span>
<span id="cb72-6"><a href="#cb72-6" aria-hidden="true" tabindex="-1"></a>           <span class="at">fall   =</span> <span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">4</span>,<span class="dv">1</span>,<span class="dv">0</span>,<span class="dv">4</span>,<span class="dv">0</span>),</span>
<span id="cb72-7"><a href="#cb72-7" aria-hidden="true" tabindex="-1"></a>           <span class="at">winter =</span> <span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">4</span>,<span class="dv">0</span>,<span class="dv">1</span>,<span class="dv">0</span>,<span class="dv">4</span>))</span>
<span id="cb72-8"><a href="#cb72-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb72-9"><a href="#cb72-9" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(K) <span class="ot">&lt;-</span> <span class="fu">names</span>(<span class="fu">coef</span>(snap_int))</span>
<span id="cb72-10"><a href="#cb72-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb72-11"><a href="#cb72-11" aria-hidden="true" tabindex="-1"></a>K</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>       (Intercept) ln_no seasonfac2Fall seasonfac3Winter ln_no:seasonfac2Fall
summer           1     4              0                0                    0
fall             1     4              1                0                    4
winter           1     4              0                1                    0
       ln_no:seasonfac3Winter
summer                      0
fall                        0
winter                      4</code></pre>
</div>
<div class="sourceCode cell-code" id="cb74"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb74-1"><a href="#cb74-1" aria-hidden="true" tabindex="-1"></a><span class="co"># estimate the summer, fall, winter effects simultaneously</span></span>
<span id="cb74-2"><a href="#cb74-2" aria-hidden="true" tabindex="-1"></a>season_effects <span class="ot">&lt;-</span> <span class="fu">glht</span>(snap_int, <span class="at">linfct =</span> K)</span>
<span id="cb74-3"><a href="#cb74-3" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(season_effects)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
     Simultaneous Tests for General Linear Hypotheses

Fit: lm(formula = ln_nox ~ ln_no * seasonfac, data = snapshot)

Linear Hypotheses:
            Estimate Std. Error t value Pr(&gt;|t|)    
summer == 0  4.24393    0.04616   91.94   &lt;2e-16 ***
fall == 0    4.48825    0.01734  258.88   &lt;2e-16 ***
winter == 0  4.47558    0.01443  310.22   &lt;2e-16 ***
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1
(Adjusted p values reported -- single-step method)</code></pre>
</div>
<div class="sourceCode cell-code" id="cb76"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb76-1"><a href="#cb76-1" aria-hidden="true" tabindex="-1"></a><span class="co"># and get its CI</span></span>
<span id="cb76-2"><a href="#cb76-2" aria-hidden="true" tabindex="-1"></a><span class="fu">confint</span>(season_effects)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
     Simultaneous Confidence Intervals

Fit: lm(formula = ln_nox ~ ln_no * seasonfac, data = snapshot)

Quantile = 2.3964
95% family-wise confidence level
 

Linear Hypotheses:
            Estimate lwr    upr   
summer == 0 4.2439   4.1333 4.3545
fall == 0   4.4883   4.4467 4.5298
winter == 0 4.4756   4.4410 4.5102</code></pre>
</div>
</div>
</section>
<section id="slide-32-example-residual-analysis-plots" class="level2">
<h2 class="anchored" data-anchor-id="slide-32-example-residual-analysis-plots">Slide 32: example residual analysis plots</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb78"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb78-1"><a href="#cb78-1" aria-hidden="true" tabindex="-1"></a><span class="co">#-----Slide32 default residuals----</span></span>
<span id="cb78-2"><a href="#cb78-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb78-3"><a href="#cb78-3" aria-hidden="true" tabindex="-1"></a><span class="co"># IDRE example from https://stats.idre.ucla.edu/r/dae/robust-regression/</span></span>
<span id="cb78-4"><a href="#cb78-4" aria-hidden="true" tabindex="-1"></a>opar <span class="ot">&lt;-</span> <span class="fu">par</span>(<span class="at">mfrow =</span> <span class="fu">c</span>(<span class="dv">2</span>,<span class="dv">2</span>), <span class="at">oma =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">0</span>, <span class="fl">1.1</span>, <span class="dv">0</span>))</span>
<span id="cb78-5"><a href="#cb78-5" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(snap_int, <span class="at">las =</span> <span class="dv">1</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="Week3Lecture_files/figure-html/slide32.default.residuals-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb79"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb79-1"><a href="#cb79-1" aria-hidden="true" tabindex="-1"></a><span class="co">#-----a basic residual plot----</span></span>
<span id="cb79-2"><a href="#cb79-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb79-3"><a href="#cb79-3" aria-hidden="true" tabindex="-1"></a><span class="co"># first add data to the snapshot data frame with `modlr` functions</span></span>
<span id="cb79-4"><a href="#cb79-4" aria-hidden="true" tabindex="-1"></a>snapshot2 <span class="ot">&lt;-</span> snapshot <span class="sc">%&gt;%</span></span>
<span id="cb79-5"><a href="#cb79-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">add_residuals</span>(snap_int,<span class="st">"resids"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb79-6"><a href="#cb79-6" aria-hidden="true" tabindex="-1"></a>    <span class="fu">add_predictions</span>(snap_int,<span class="st">"preds"</span>)</span>
<span id="cb79-7"><a href="#cb79-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb79-8"><a href="#cb79-8" aria-hidden="true" tabindex="-1"></a><span class="co"># then make scatterplot</span></span>
<span id="cb79-9"><a href="#cb79-9" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(snapshot2, <span class="fu">aes</span>(<span class="at">x =</span> preds, <span class="at">y =</span> resids)) <span class="sc">+</span></span>
<span id="cb79-10"><a href="#cb79-10" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb79-11"><a href="#cb79-11" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_abline</span>(<span class="at">slope =</span> <span class="dv">0</span>, <span class="at">intercept =</span> <span class="dv">0</span>) <span class="sc">+</span></span>
<span id="cb79-12"><a href="#cb79-12" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_smooth</span>(<span class="at">method =</span> <span class="st">"loess"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="Week3Lecture_files/figure-html/a.basic.residual.plot-1.png" class="img-fluid" width="672"></p>
</div>
</div>
</section>
<section id="slide-35-regression-for-prediction-starting-to-replicate-table-4-of-mercer-et-al-summer" class="level2">
<h2 class="anchored" data-anchor-id="slide-35-regression-for-prediction-starting-to-replicate-table-4-of-mercer-et-al-summer">Slide 35: Regression for prediction – starting to replicate Table 4 of Mercer et al Summer</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb80"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb80-1"><a href="#cb80-1" aria-hidden="true" tabindex="-1"></a><span class="co">#-----slide35----  </span></span>
<span id="cb80-2"><a href="#cb80-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb80-3"><a href="#cb80-3" aria-hidden="true" tabindex="-1"></a><span class="co"># replicate the summer model in Table 4</span></span>
<span id="cb80-4"><a href="#cb80-4" aria-hidden="true" tabindex="-1"></a><span class="co"># First create a summer only dataset with only the variables of interest</span></span>
<span id="cb80-5"><a href="#cb80-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb80-6"><a href="#cb80-6" aria-hidden="true" tabindex="-1"></a><span class="co"># specify covariates of interest (omitting outcome variable)</span></span>
<span id="cb80-7"><a href="#cb80-7" aria-hidden="true" tabindex="-1"></a>vars <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"D2A1"</span>, <span class="st">"A1_50"</span>, <span class="st">"A23_400"</span>, <span class="st">"Pop_5000"</span>, <span class="st">"D2C"</span>, <span class="st">"Int_3000"</span>, <span class="st">"D2Comm"</span>)</span>
<span id="cb80-8"><a href="#cb80-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb80-9"><a href="#cb80-9" aria-hidden="true" tabindex="-1"></a><span class="co"># create dataframe</span></span>
<span id="cb80-10"><a href="#cb80-10" aria-hidden="true" tabindex="-1"></a>summer <span class="ot">&lt;-</span> snapshot <span class="sc">%&gt;%</span></span>
<span id="cb80-11"><a href="#cb80-11" aria-hidden="true" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">filter</span>(season <span class="sc">==</span> <span class="dv">1</span>) <span class="sc">%&gt;%</span></span>
<span id="cb80-12"><a href="#cb80-12" aria-hidden="true" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">select</span>(ln_nox, <span class="fu">all_of</span>(vars))</span>
<span id="cb80-13"><a href="#cb80-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb80-14"><a href="#cb80-14" aria-hidden="true" tabindex="-1"></a><span class="co"># specify regression formula</span></span>
<span id="cb80-15"><a href="#cb80-15" aria-hidden="true" tabindex="-1"></a>frml <span class="ot">&lt;-</span> <span class="fu">as.formula</span>(<span class="fu">paste</span>(<span class="st">"ln_nox ~ "</span>, <span class="fu">paste</span>(vars, <span class="at">collapse =</span> <span class="st">"+"</span>) ) )</span>
<span id="cb80-16"><a href="#cb80-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb80-17"><a href="#cb80-17" aria-hidden="true" tabindex="-1"></a><span class="co"># fit regression model</span></span>
<span id="cb80-18"><a href="#cb80-18" aria-hidden="true" tabindex="-1"></a>summer_mod <span class="ot">&lt;-</span> <span class="fu">lm</span>(frml, <span class="at">data =</span> summer)</span>
<span id="cb80-19"><a href="#cb80-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb80-20"><a href="#cb80-20" aria-hidden="true" tabindex="-1"></a><span class="co"># show the results</span></span>
<span id="cb80-21"><a href="#cb80-21" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(summer_mod)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
lm(formula = frml, data = summer)

Residuals:
     Min       1Q   Median       3Q      Max 
-0.57337 -0.10017 -0.00186  0.11208  0.65811 

Coefficients:
             Estimate Std. Error t value Pr(&gt;|t|)    
(Intercept)   2.99774    0.18905  15.857  &lt; 2e-16 ***
D2A1         -0.27239    0.03670  -7.421 1.02e-11 ***
A1_50       -10.92040    7.64102  -1.429  0.15518    
A23_400       0.34994    0.27533   1.271  0.20584    
Pop_5000     -0.02557    0.01785  -1.433  0.15421    
D2C           7.11637    0.41542  17.130  &lt; 2e-16 ***
Int_3000      1.85241    0.57055   3.247  0.00146 ** 
D2Comm       -1.09132    0.83369  -1.309  0.19267    
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

Residual standard error: 0.2081 on 140 degrees of freedom
Multiple R-squared:  0.7252,    Adjusted R-squared:  0.7114 
F-statistic: 52.78 on 7 and 140 DF,  p-value: &lt; 2.2e-16</code></pre>
</div>
</div>
</section>
<section id="slide-36-regression-for-prediction-getting-fitted-values-and-se-of-mean-vs-new-value-plus-show-r2square-of-correlation" class="level2">
<h2 class="anchored" data-anchor-id="slide-36-regression-for-prediction-getting-fitted-values-and-se-of-mean-vs-new-value-plus-show-r2square-of-correlation">Slide 36: Regression for prediction: getting fitted values and SE of mean vs new value PLUS show R2=square of correlation</h2>
<p>Resulting correlation should be about .85 to get the estimated R2 of .7252.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb82"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb82-1"><a href="#cb82-1" aria-hidden="true" tabindex="-1"></a><span class="co">#-----slide36 fitted values and residuals----</span></span>
<span id="cb82-2"><a href="#cb82-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-3"><a href="#cb82-3" aria-hidden="true" tabindex="-1"></a><span class="co">#Note:  Dropping the use of a new "summer2" dataframe as not needed.  Slides introduce a new data frame</span></span>
<span id="cb82-4"><a href="#cb82-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-5"><a href="#cb82-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Then add the predictions (and the residuals to the dataset)</span></span>
<span id="cb82-6"><a href="#cb82-6" aria-hidden="true" tabindex="-1"></a>summer <span class="ot">&lt;-</span> summer <span class="sc">%&gt;%</span>  </span>
<span id="cb82-7"><a href="#cb82-7" aria-hidden="true" tabindex="-1"></a>    <span class="fu">add_residuals</span>(summer_mod,<span class="st">"resids"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb82-8"><a href="#cb82-8" aria-hidden="true" tabindex="-1"></a>    <span class="fu">add_predictions</span>(summer_mod,<span class="st">"preds"</span>)</span>
<span id="cb82-9"><a href="#cb82-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-10"><a href="#cb82-10" aria-hidden="true" tabindex="-1"></a><span class="co"># and estimate the correlation</span></span>
<span id="cb82-11"><a href="#cb82-11" aria-hidden="true" tabindex="-1"></a>r <span class="ot">&lt;-</span> <span class="fu">cor</span>(summer<span class="sc">$</span>preds, summer<span class="sc">$</span>ln_nox)</span>
<span id="cb82-12"><a href="#cb82-12" aria-hidden="true" tabindex="-1"></a>insamp_R2 <span class="ot">&lt;-</span> r<span class="sc">^</span><span class="dv">2</span></span>
<span id="cb82-13"><a href="#cb82-13" aria-hidden="true" tabindex="-1"></a><span class="fu">paste</span>(<span class="st">"In-sample R2:  "</span>, insamp_R2)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "In-sample R2:   0.725187121717616"</code></pre>
</div>
<div class="sourceCode cell-code" id="cb84"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb84-1"><a href="#cb84-1" aria-hidden="true" tabindex="-1"></a><span class="fu">paste</span>(<span class="st">"correlation:  "</span>, r)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "correlation:   0.851579192863245"</code></pre>
</div>
</div>
</section>
<section id="slide-37-plot-of-regression-with-prediction-interval-and-add-alongside-the-one-with-the-ci" class="level2">
<h2 class="anchored" data-anchor-id="slide-37-plot-of-regression-with-prediction-interval-and-add-alongside-the-one-with-the-ci">Slide 37: Plot of regression with prediction interval, and add alongside the one with the CI</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb86"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb86-1"><a href="#cb86-1" aria-hidden="true" tabindex="-1"></a><span class="co">#-----slide 37: plots w/ prediction intervals----</span></span>
<span id="cb86-2"><a href="#cb86-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb86-3"><a href="#cb86-3" aria-hidden="true" tabindex="-1"></a><span class="co"># in ggplot it is easy to get CIs of fitted lines but more work to get prediction intervals.  We show both here.</span></span>
<span id="cb86-4"><a href="#cb86-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Note:  add_predictions doesn't also add uncertainty of predictions</span></span>
<span id="cb86-5"><a href="#cb86-5" aria-hidden="true" tabindex="-1"></a><span class="co"># first get the prediction intervals</span></span>
<span id="cb86-6"><a href="#cb86-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Note:  you can do this twice on the same dataset and get the same 4 variables</span></span>
<span id="cb86-7"><a href="#cb86-7" aria-hidden="true" tabindex="-1"></a><span class="co"># appended twice.  If you use different interval options (interval="confidence"</span></span>
<span id="cb86-8"><a href="#cb86-8" aria-hidden="true" tabindex="-1"></a><span class="co"># vs. interval="prediction" you will get different values in the created</span></span>
<span id="cb86-9"><a href="#cb86-9" aria-hidden="true" tabindex="-1"></a><span class="co"># variables "lwr" and "upr" corresponding to the type of interval.  Note: you</span></span>
<span id="cb86-10"><a href="#cb86-10" aria-hidden="true" tabindex="-1"></a><span class="co"># can't use a dataframe with multiple variables with the same name.</span></span>
<span id="cb86-11"><a href="#cb86-11" aria-hidden="true" tabindex="-1"></a> </span>
<span id="cb86-12"><a href="#cb86-12" aria-hidden="true" tabindex="-1"></a><span class="co"># predict creates the variables fit, lwr, upr</span></span>
<span id="cb86-13"><a href="#cb86-13" aria-hidden="true" tabindex="-1"></a>summer2 <span class="ot">&lt;-</span> <span class="fu">cbind</span>(summer, <span class="fu">predict</span>(summer_mod, <span class="at">interval =</span> <span class="st">"prediction"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning in predict.lm(summer_mod, interval = "prediction"): predictions on current data refer to _future_ responses</code></pre>
</div>
<div class="sourceCode cell-code" id="cb88"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb88-1"><a href="#cb88-1" aria-hidden="true" tabindex="-1"></a><span class="co"># get the plotting range</span></span>
<span id="cb88-2"><a href="#cb88-2" aria-hidden="true" tabindex="-1"></a>summer_mod_range <span class="ot">&lt;-</span> <span class="fu">with</span>(summer2, <span class="fu">range</span>(ln_nox, lwr, upr))</span>
<span id="cb88-3"><a href="#cb88-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb88-4"><a href="#cb88-4" aria-hidden="true" tabindex="-1"></a><span class="co"># plot with 95% CI on the fitted line, uses default ggplot option</span></span>
<span id="cb88-5"><a href="#cb88-5" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(summer2, <span class="fu">aes</span>(<span class="at">x =</span> fit, <span class="at">y =</span> ln_nox)) <span class="sc">+</span></span>
<span id="cb88-6"><a href="#cb88-6" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb88-7"><a href="#cb88-7" aria-hidden="true" tabindex="-1"></a>    <span class="fu">stat_smooth</span>(<span class="at">method =</span> lm, <span class="at">se =</span> <span class="cn">TRUE</span>) <span class="sc">+</span></span>
<span id="cb88-8"><a href="#cb88-8" aria-hidden="true" tabindex="-1"></a>    <span class="fu">coord_fixed</span>() <span class="sc">+</span></span>
<span id="cb88-9"><a href="#cb88-9" aria-hidden="true" tabindex="-1"></a>    <span class="fu">xlim</span>(summer_mod_range) <span class="sc">+</span> </span>
<span id="cb88-10"><a href="#cb88-10" aria-hidden="true" tabindex="-1"></a>    <span class="fu">ylim</span>(summer_mod_range) <span class="sc">+</span></span>
<span id="cb88-11"><a href="#cb88-11" aria-hidden="true" tabindex="-1"></a>    <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Mercer et al (2011) Table 4 Summer model fit:</span><span class="sc">\n</span><span class="st">predictions vs. observations (ln(ppb)) and 95% CI"</span>, </span>
<span id="cb88-12"><a href="#cb88-12" aria-hidden="true" tabindex="-1"></a>         <span class="at">x =</span> <span class="st">"predicted ln(NOx) (ln(ppb))"</span>,</span>
<span id="cb88-13"><a href="#cb88-13" aria-hidden="true" tabindex="-1"></a>         <span class="at">y =</span> <span class="st">"observed ln(NOx) (ln(ppb))"</span></span>
<span id="cb88-14"><a href="#cb88-14" aria-hidden="true" tabindex="-1"></a>         ) <span class="sc">+</span> </span>
<span id="cb88-15"><a href="#cb88-15" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme_bw</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="Week3Lecture_files/figure-html/slide37-1.png" class="img-fluid" width="672"></p>
</div>
<div class="sourceCode cell-code" id="cb89"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb89-1"><a href="#cb89-1" aria-hidden="true" tabindex="-1"></a><span class="co"># plot with 95% PI on the fitted line, need extra code to handle this </span></span>
<span id="cb89-2"><a href="#cb89-2" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(summer2, <span class="fu">aes</span>(fit)) <span class="sc">+</span></span>
<span id="cb89-3"><a href="#cb89-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">y =</span> ln_nox)) <span class="sc">+</span></span>
<span id="cb89-4"><a href="#cb89-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_ribbon</span>(<span class="fu">aes</span>(<span class="at">ymin =</span> lwr, <span class="at">ymax =</span> upr), <span class="at">fill =</span> <span class="st">"blue"</span>, <span class="at">alpha =</span> <span class="fl">0.2</span>) <span class="sc">+</span></span>
<span id="cb89-5"><a href="#cb89-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">y =</span> fit), <span class="at">color =</span> <span class="st">"blue"</span>, <span class="at">size =</span> <span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb89-6"><a href="#cb89-6" aria-hidden="true" tabindex="-1"></a>    <span class="fu">coord_fixed</span>() <span class="sc">+</span></span>
<span id="cb89-7"><a href="#cb89-7" aria-hidden="true" tabindex="-1"></a>    <span class="fu">xlim</span>(summer_mod_range) <span class="sc">+</span> </span>
<span id="cb89-8"><a href="#cb89-8" aria-hidden="true" tabindex="-1"></a>    <span class="fu">ylim</span>(summer_mod_range) <span class="sc">+</span> </span>
<span id="cb89-9"><a href="#cb89-9" aria-hidden="true" tabindex="-1"></a>    <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Mercer et al (2011) Table 4 Summer model fit:</span><span class="sc">\n</span><span class="st">predictions vs. observations (ln(ppb)) and 95% PI"</span>,</span>
<span id="cb89-10"><a href="#cb89-10" aria-hidden="true" tabindex="-1"></a>         <span class="at">x =</span> <span class="st">"predicted ln(NOx) (ln(ppb))"</span>,</span>
<span id="cb89-11"><a href="#cb89-11" aria-hidden="true" tabindex="-1"></a>         <span class="at">y =</span> <span class="st">"observed ln(NOx) (ln(ppb))"</span></span>
<span id="cb89-12"><a href="#cb89-12" aria-hidden="true" tabindex="-1"></a>         ) <span class="sc">+</span> </span>
<span id="cb89-13"><a href="#cb89-13" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme_bw</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: Using `size` aesthetic for lines was deprecated in ggplot2 3.4.0.
ℹ Please use `linewidth` instead.</code></pre>
</div>
<div class="cell-output-display">
<p><img src="Week3Lecture_files/figure-html/slide37-2.png" class="img-fluid" width="672"></p>
</div>
</div>
</section>

</main>
<!-- /main column -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->



</body></html>