<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.3.433">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Lianne Sheppard for ENVH 556 Autumn 2024">

<title>Week 3 Lab: Regression for Association</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="Week3Lab_files/libs/clipboard/clipboard.min.js"></script>
<script src="Week3Lab_files/libs/quarto-html/quarto.js"></script>
<script src="Week3Lab_files/libs/quarto-html/popper.min.js"></script>
<script src="Week3Lab_files/libs/quarto-html/tippy.umd.min.js"></script>
<script src="Week3Lab_files/libs/quarto-html/anchor.min.js"></script>
<link href="Week3Lab_files/libs/quarto-html/tippy.css" rel="stylesheet">
<link href="Week3Lab_files/libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="Week3Lab_files/libs/bootstrap/bootstrap.min.js"></script>
<link href="Week3Lab_files/libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="Week3Lab_files/libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">


</head>

<body class="fullcontent">

<div id="quarto-content" class="page-columns page-rows-contents page-layout-article">

<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Week 3 Lab: Regression for Association</h1>
</div>



<div class="quarto-title-meta">

    <div>
    <div class="quarto-title-meta-heading">Author</div>
    <div class="quarto-title-meta-contents">
             <p>Lianne Sheppard for ENVH 556 Autumn 2024 </p>
          </div>
  </div>
    
  
    
  </div>
  

</header>

<p>This document was rendered on September 25, 2024.</p>
<section id="purpose" class="level1">
<h1>Purpose</h1>
<p>The purpose of this lab is to get practice using and reporting regression models with a focus on regression for association and some beginning work on regression for prediction. We will use the snapshot data for this lab.</p>
</section>
<section id="getting-started" class="level1">
<h1>Getting Started</h1>
<p>This section gives some basic R commands for regression for association and the first steps for evaluating predictions.</p>
<ul>
<li>Summarizing <em>ln_nox</em> by season</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="co">#-----summarize ln_nox-----</span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="co"># frequencies only</span></span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(snapshot<span class="sc">$</span>seasonfac)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>1Summer   2Fall 3Winter 
    148     152     149 </code></pre>
</div>
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="co"># descriptive statistics</span></span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a>snapshot_summary <span class="ot">&lt;-</span> snapshot <span class="sc">%&gt;%</span>     </span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">group_by</span>(seasonfac) <span class="sc">%&gt;%</span></span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">summarise</span>(<span class="at">N =</span> <span class="fu">n</span>(),</span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a>              <span class="at">Mean =</span> <span class="fu">mean</span>(ln_nox), </span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a>              <span class="at">SD =</span> <span class="fu">sd</span>(ln_nox),</span>
<span id="cb3-7"><a href="#cb3-7" aria-hidden="true" tabindex="-1"></a>              <span class="at">GM =</span> <span class="fu">exp</span>(<span class="fu">mean</span>(ln_nox)), </span>
<span id="cb3-8"><a href="#cb3-8" aria-hidden="true" tabindex="-1"></a>              <span class="at">GSD =</span> <span class="fu">exp</span>(<span class="fu">sd</span>(ln_nox)), </span>
<span id="cb3-9"><a href="#cb3-9" aria-hidden="true" tabindex="-1"></a>              <span class="at">.groups =</span> <span class="st">"drop"</span>)</span>
<span id="cb3-10"><a href="#cb3-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-11"><a href="#cb3-11" aria-hidden="true" tabindex="-1"></a><span class="co"># kable table</span></span>
<span id="cb3-12"><a href="#cb3-12" aria-hidden="true" tabindex="-1"></a><span class="fu">kable</span>(snapshot_summary, <span class="at">digits=</span><span class="dv">2</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<table class="table table-sm table-striped small">
<thead>
<tr class="header">
<th style="text-align: left;">seasonfac</th>
<th style="text-align: right;">N</th>
<th style="text-align: right;">Mean</th>
<th style="text-align: right;">SD</th>
<th style="text-align: right;">GM</th>
<th style="text-align: right;">GSD</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">1Summer</td>
<td style="text-align: right;">148</td>
<td style="text-align: right;">3.47</td>
<td style="text-align: right;">0.39</td>
<td style="text-align: right;">32.11</td>
<td style="text-align: right;">1.47</td>
</tr>
<tr class="even">
<td style="text-align: left;">2Fall</td>
<td style="text-align: right;">152</td>
<td style="text-align: right;">4.27</td>
<td style="text-align: right;">0.32</td>
<td style="text-align: right;">71.49</td>
<td style="text-align: right;">1.37</td>
</tr>
<tr class="odd">
<td style="text-align: left;">3Winter</td>
<td style="text-align: right;">149</td>
<td style="text-align: right;">4.51</td>
<td style="text-align: right;">0.30</td>
<td style="text-align: right;">91.33</td>
<td style="text-align: right;">1.35</td>
</tr>
</tbody>
</table>
</div>
</div>
<ul>
<li>Commands for season-specific boxplots:</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="co">#-----season-specific boxplots-----</span></span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(snapshot, <span class="fu">aes</span>(<span class="at">x =</span> seasonfac, <span class="at">y =</span> ln_nox, <span class="at">fill =</span> seasonfac)) <span class="sc">+</span></span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_boxplot</span>() <span class="sc">+</span></span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">"Season"</span>, </span>
<span id="cb4-6"><a href="#cb4-6" aria-hidden="true" tabindex="-1"></a>         <span class="at">y =</span> <span class="st">"ln(NOx) (ln(ppb)"</span>, </span>
<span id="cb4-7"><a href="#cb4-7" aria-hidden="true" tabindex="-1"></a>         <span class="at">color =</span> <span class="st">"Season"</span>, </span>
<span id="cb4-8"><a href="#cb4-8" aria-hidden="true" tabindex="-1"></a>         <span class="at">fill =</span> <span class="st">"Season"</span>) <span class="sc">+</span> </span>
<span id="cb4-9"><a href="#cb4-9" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme_article</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="Week3Lab_files/figure-html/season-specific%20boxplots-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<ul>
<li>Commands for regression:</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="co">#-----regression for association-----</span></span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Common model (Table 4), season-specific LUR</span></span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a><span class="co"># specify regression model</span></span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a>frml <span class="ot">&lt;-</span> <span class="fu">as.formula</span>(ln_nox <span class="sc">~</span> D2A1 <span class="sc">+</span> A1_50 <span class="sc">+</span> A23_400 <span class="sc">+</span> Pop_5000 <span class="sc">+</span> D2C <span class="sc">+</span> Int_3000 <span class="sc">+</span> D2Comm)</span>
<span id="cb5-7"><a href="#cb5-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-8"><a href="#cb5-8" aria-hidden="true" tabindex="-1"></a><span class="co"># summarize the fit of each model</span></span>
<span id="cb5-9"><a href="#cb5-9" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(lm_summer <span class="ot">&lt;-</span> <span class="fu">lm</span>(frml, <span class="at">data =</span> snapshot, <span class="at">subset =</span> seasonfac <span class="sc">==</span> <span class="st">"1Summer"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
lm(formula = frml, data = snapshot, subset = seasonfac == "1Summer")

Residuals:
     Min       1Q   Median       3Q      Max 
-0.57337 -0.10017 -0.00186  0.11208  0.65811 

Coefficients:
             Estimate Std. Error t value Pr(&gt;|t|)    
(Intercept)   2.99774    0.18905  15.857  &lt; 2e-16 ***
D2A1         -0.27239    0.03670  -7.421 1.02e-11 ***
A1_50       -10.92040    7.64102  -1.429  0.15518    
A23_400       0.34994    0.27533   1.271  0.20584    
Pop_5000     -0.02557    0.01785  -1.433  0.15421    
D2C           7.11637    0.41542  17.130  &lt; 2e-16 ***
Int_3000      1.85241    0.57055   3.247  0.00146 ** 
D2Comm       -1.09132    0.83369  -1.309  0.19267    
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

Residual standard error: 0.2081 on 140 degrees of freedom
Multiple R-squared:  0.7252,    Adjusted R-squared:  0.7114 
F-statistic: 52.78 on 7 and 140 DF,  p-value: &lt; 2.2e-16</code></pre>
</div>
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(lm_fall <span class="ot">&lt;-</span> <span class="fu">lm</span>(frml, <span class="at">data =</span> snapshot, <span class="at">subset =</span> seasonfac <span class="sc">==</span> <span class="st">"2Fall"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
lm(formula = frml, data = snapshot, subset = seasonfac == "2Fall")

Residuals:
     Min       1Q   Median       3Q      Max 
-0.42275 -0.10236 -0.01733  0.10553  0.53136 

Coefficients:
            Estimate Std. Error t value Pr(&gt;|t|)    
(Intercept)  4.01968    0.16983  23.669  &lt; 2e-16 ***
D2A1        -0.15946    0.03236  -4.928 2.25e-06 ***
A1_50       19.88445    6.83755   2.908 0.004213 ** 
A23_400      0.46478    0.24655   1.885 0.061422 .  
Pop_5000     0.11941    0.01660   7.193 3.20e-11 ***
D2C          1.24961    0.35904   3.480 0.000663 ***
Int_3000     1.07563    0.50652   2.124 0.035415 *  
D2Comm      -5.05144    0.75150  -6.722 3.90e-10 ***
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

Residual standard error: 0.1863 on 144 degrees of freedom
Multiple R-squared:  0.6716,    Adjusted R-squared:  0.6557 
F-statistic: 42.07 on 7 and 144 DF,  p-value: &lt; 2.2e-16</code></pre>
</div>
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(lm_winter <span class="ot">&lt;-</span> <span class="fu">lm</span>(frml, <span class="at">data =</span> snapshot, <span class="at">subset =</span> seasonfac <span class="sc">==</span> <span class="st">"3Winter"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
lm(formula = frml, data = snapshot, subset = seasonfac == "3Winter")

Residuals:
     Min       1Q   Median       3Q      Max 
-0.40575 -0.12305  0.01082  0.12171  0.40447 

Coefficients:
            Estimate Std. Error t value Pr(&gt;|t|)    
(Intercept)  3.26098    0.19350  16.853  &lt; 2e-16 ***
D2A1        -0.11185    0.03179  -3.518 0.000586 ***
A1_50       14.93984    6.11747   2.442 0.015837 *  
A23_400      1.04553    0.21290   4.911 2.47e-06 ***
Pop_5000     0.05502    0.01526   3.605 0.000433 ***
D2C          1.88377    0.36366   5.180 7.52e-07 ***
Int_3000     4.31840    0.65483   6.595 7.94e-10 ***
D2Comm      -1.65208    0.76549  -2.158 0.032606 *  
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

Residual standard error: 0.1738 on 141 degrees of freedom
Multiple R-squared:  0.6775,    Adjusted R-squared:  0.6615 
F-statistic: 42.31 on 7 and 141 DF,  p-value: &lt; 2.2e-16</code></pre>
</div>
</div>
<ul>
<li>Making predictions:</li>
</ul>
<p>This gives season-specific predictions in the dataset with all seasons.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="co">#-----predictions with dplyr-----</span></span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a><span class="co"># this adds model-specific predictions, both in-sample and out-of-sample</span></span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a><span class="co"># however, we don't get the prediction intervals or SEs this way</span></span>
<span id="cb11-5"><a href="#cb11-5" aria-hidden="true" tabindex="-1"></a>snap2 <span class="ot">&lt;-</span> snapshot <span class="sc">%&gt;%</span> </span>
<span id="cb11-6"><a href="#cb11-6" aria-hidden="true" tabindex="-1"></a>    <span class="co"># summer</span></span>
<span id="cb11-7"><a href="#cb11-7" aria-hidden="true" tabindex="-1"></a>    <span class="fu">add_residuals</span>(lm_summer,<span class="st">"resids_sum"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb11-8"><a href="#cb11-8" aria-hidden="true" tabindex="-1"></a>    <span class="fu">add_predictions</span>(lm_summer,<span class="st">"preds_sum"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb11-9"><a href="#cb11-9" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb11-10"><a href="#cb11-10" aria-hidden="true" tabindex="-1"></a>    <span class="co"># fall</span></span>
<span id="cb11-11"><a href="#cb11-11" aria-hidden="true" tabindex="-1"></a>    <span class="fu">add_residuals</span>(lm_fall,<span class="st">"resids_fall"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb11-12"><a href="#cb11-12" aria-hidden="true" tabindex="-1"></a>    <span class="fu">add_predictions</span>(lm_fall,<span class="st">"preds_fall"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb11-13"><a href="#cb11-13" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb11-14"><a href="#cb11-14" aria-hidden="true" tabindex="-1"></a>    <span class="co"># winter</span></span>
<span id="cb11-15"><a href="#cb11-15" aria-hidden="true" tabindex="-1"></a>    <span class="fu">add_residuals</span>(lm_winter,<span class="st">"resids_win"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb11-16"><a href="#cb11-16" aria-hidden="true" tabindex="-1"></a>    <span class="fu">add_predictions</span>(lm_winter,<span class="st">"preds_win"</span>)</span>
<span id="cb11-17"><a href="#cb11-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-18"><a href="#cb11-18" aria-hidden="true" tabindex="-1"></a><span class="co"># inspect predictions and residuals</span></span>
<span id="cb11-19"><a href="#cb11-19" aria-hidden="true" tabindex="-1"></a>snap2 <span class="sc">%&gt;%</span> </span>
<span id="cb11-20"><a href="#cb11-20" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(<span class="at">SeasonID =</span> seasonfac, ln_nox, preds_sum, resids_sum, preds_fall,</span>
<span id="cb11-21"><a href="#cb11-21" aria-hidden="true" tabindex="-1"></a>                resids_fall, preds_win, resids_win) <span class="sc">%&gt;%</span> </span>
<span id="cb11-22"><a href="#cb11-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate_if</span>(is.double, round, <span class="dv">2</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>    SeasonID ln_nox preds_sum resids_sum preds_fall resids_fall preds_win
1    1Summer   3.48      3.55      -0.07       4.07       -0.58      4.38
2    1Summer   3.62      3.62       0.00       4.22       -0.60      4.57
3    1Summer   3.81      3.62       0.20       4.22       -0.41      4.58
4    1Summer   3.52      3.61      -0.09       4.21       -0.69      4.57
5    1Summer   3.59      3.60       0.00       4.17       -0.58      4.55
6    1Summer   3.49      3.55      -0.06       4.03       -0.54      4.45
7    1Summer   3.53      3.49       0.04       4.39       -0.85      4.60
8    1Summer   3.43      3.53      -0.10       4.53       -1.09      4.68
9    1Summer   3.55      3.55       0.00       4.56       -1.01      4.72
10   1Summer   3.43      3.56      -0.13       4.57       -1.14      4.74
11   1Summer   3.41      3.56      -0.15       4.54       -1.13      4.74
12   1Summer   3.37      3.56      -0.20       4.57       -1.20      4.72
13   1Summer   3.71      3.59       0.11       4.16       -0.45      4.39
14   1Summer   3.70      3.63       0.07       4.22       -0.52      4.43
15   1Summer   3.68      3.63       0.05       4.20       -0.52      4.43
16   1Summer   3.78      3.64       0.14       4.21       -0.43      4.44
17   1Summer   3.70      3.64       0.06       4.23       -0.53      4.44
18   1Summer   3.81      3.64       0.16       4.21       -0.40      4.39
19   1Summer   3.61      3.55       0.05       4.35       -0.75      4.54
20   1Summer   3.69      3.55       0.14       4.38       -0.69      4.59
21   1Summer   3.56      3.55       0.01       4.39       -0.82      4.60
22   1Summer   3.63      3.56       0.07       4.44       -0.82      4.63
23   1Summer   3.38      3.55      -0.18       4.45       -1.08      4.63
24   1Summer   3.51      3.53      -0.02       4.47       -0.96      4.62
25   1Summer   3.74      3.70       0.04       4.47       -0.73      4.69
26   1Summer   3.97      3.72       0.26       4.44       -0.47      4.65
27   1Summer   4.03      3.87       0.16       4.52       -0.49      4.75
28   1Summer   3.75      3.88      -0.12       4.57       -0.81      4.78
29   1Summer   3.87      3.79       0.07       4.54       -0.67      4.76
30   1Summer   3.86      3.73       0.13       4.53       -0.67      4.74
31   1Summer   3.40      3.15       0.25       4.24       -0.84      4.38
32   1Summer   3.34      3.15       0.19       4.25       -0.91      4.40
33   1Summer   3.36      3.16       0.20       4.26       -0.90      4.40
34   1Summer   3.27      3.16       0.11       4.22       -0.95      4.40
35   1Summer   3.52      3.16       0.36       4.21       -0.69      4.39
36   1Summer   3.53      3.19       0.34       4.28       -0.75      4.41
37   1Summer   2.97      3.00      -0.03       4.36       -1.39      4.51
38   1Summer   3.17      3.13       0.04       4.38       -1.21      4.54
39   1Summer   3.20      3.20       0.00       4.57       -1.36      4.69
40   1Summer   3.54      3.20       0.35       4.54       -1.00      4.67
41   1Summer   3.10      3.16      -0.06       4.28       -1.18      4.51
42   1Summer   3.13      3.03       0.10       4.14       -1.01      4.42
43   1Summer   3.55      3.46       0.09       3.83       -0.28      4.07
44   1Summer   3.50      3.49       0.01       3.82       -0.32      4.11
45   1Summer   3.54      3.50       0.04       3.81       -0.27      4.12
46   1Summer   3.52      3.52       0.00       3.82       -0.30      4.14
47   1Summer   3.56      3.54       0.02       3.85       -0.30      4.19
48   1Summer   3.45      3.62      -0.17       3.99       -0.54      4.28
49   1Summer   3.19      3.22      -0.03       3.83       -0.64      4.28
50   1Summer   3.27      3.27       0.00       3.92       -0.65      4.37
51   1Summer   3.29      3.27       0.02       3.93       -0.64      4.38
52   1Summer   3.21      3.28      -0.07       3.93       -0.72      4.38
53   1Summer   3.19      3.28      -0.09       3.92       -0.72      4.37
54   1Summer   3.24      3.25      -0.01       3.84       -0.60      4.27
55   1Summer   3.79      3.71       0.08       4.16       -0.37      4.28
56   1Summer   3.61      3.66      -0.06       4.11       -0.51      4.27
57   1Summer   3.65      3.65       0.00       4.09       -0.44      4.26
58   1Summer   3.54      3.64      -0.10       4.07       -0.53      4.25
59   1Summer   3.53      3.61      -0.08       4.01       -0.48      4.20
60   1Summer   3.56      3.55       0.01       3.92       -0.36      4.03
61   1Summer   2.49      2.52      -0.03       3.83       -1.35      4.04
62   1Summer   3.35      3.46      -0.11       4.74       -1.39      4.83
63   1Summer   3.16      3.36      -0.20       4.53       -1.37      4.80
64   1Summer   3.42      3.39       0.04       4.33       -0.91      4.52
65   1Summer   3.80      3.53       0.27       4.23       -0.43      4.45
66   1Summer   3.73      3.55       0.18       4.33       -0.60      4.51
67   1Summer   3.68      3.54       0.14       4.28       -0.60      4.50
68   1Summer   3.70      3.55       0.15       4.30       -0.60      4.49
69   1Summer   3.66      3.51       0.15       4.16       -0.50      4.38
70   1Summer   4.06      3.90       0.16       4.59       -0.53      4.85
71   1Summer   4.17      3.90       0.27       4.96       -0.79      5.14
72   1Summer   3.58      3.88      -0.30       4.93       -1.35      5.12
73   1Summer   3.72      3.89      -0.17       4.60       -0.88      4.84
74   1Summer   3.48      3.79      -0.32       4.55       -1.08      4.77
75   1Summer   3.74      3.60       0.14       4.47       -0.73      4.71
76   1Summer   3.68      3.60       0.08       4.54       -0.85      4.73
77   1Summer   3.55      3.59      -0.04       4.51       -0.96      4.72
78   1Summer   3.50      3.59      -0.09       4.48       -0.98      4.71
79   1Summer   3.49      3.58      -0.09       4.47       -0.99      4.66
80   1Summer   3.51      3.51       0.00       4.49       -0.97      4.64
81   1Summer   3.39      3.56      -0.17       4.60       -1.21      4.73
82   1Summer   3.62      3.56       0.06       4.60       -0.98      4.73
83   1Summer   3.48      3.56      -0.08       4.56       -1.08      4.71
84   1Summer   3.46      3.56      -0.10       4.54       -1.08      4.71
85   1Summer   3.43      3.53      -0.09       4.39       -0.95      4.62
86   1Summer   2.88      2.92      -0.04       3.82       -0.94      4.22
87   1Summer   3.09      2.97       0.11       3.97       -0.88      4.34
88   1Summer   3.44      2.98       0.46       3.99       -0.55      4.35
89   1Summer   3.07      2.99       0.08       4.01       -0.94      4.36
90   1Summer   2.84      2.99      -0.15       4.04       -1.20      4.36
91   1Summer   2.93      2.98      -0.05       4.06       -1.13      4.30
92   1Summer   3.25      3.45      -0.20       4.49       -1.23      4.63
93   1Summer   3.40      3.45      -0.05       4.51       -1.10      4.69
94   1Summer   4.04      3.45       0.59       4.50       -0.46      4.69
95   1Summer   3.17      3.36      -0.19       4.35       -1.19      4.52
96   1Summer   3.36      3.37      -0.01       4.40       -1.04      4.56
97   1Summer   3.34      3.36      -0.02       4.44       -1.11      4.59
98   1Summer   4.00      3.34       0.66       4.43       -0.43      4.58
99   1Summer   3.26      3.32      -0.06       4.39       -1.13      4.56
100  1Summer   3.35      3.31       0.04       4.36       -1.01      4.55
101  1Summer   3.24      3.25      -0.02       4.24       -1.00      4.47
102  1Summer   3.13      3.02       0.11       4.32       -1.19      4.52
103  1Summer   3.68      3.84      -0.16       4.37       -0.69      4.74
104  1Summer   2.23      2.37      -0.14       3.72       -1.49      3.66
105  1Summer   3.74      3.63       0.11       4.12       -0.38      4.33
106  1Summer   3.83      3.60       0.23       4.33       -0.51      4.64
107  1Summer   2.10      2.42      -0.32       3.91       -1.81      4.00
108  1Summer   2.29      2.34      -0.05       3.78       -1.49      3.84
109  1Summer   2.22      2.32      -0.10       3.74       -1.52      3.78
110  1Summer   1.69      2.27      -0.57       3.64       -1.95      3.69
111  1Summer   2.87      3.12      -0.25       4.13       -1.26      4.35
112  1Summer   3.35      3.26       0.08       4.26       -0.92      4.40
113  1Summer   3.62      3.30       0.32       4.29       -0.67      4.42
114  1Summer   3.01      3.30      -0.29       4.54       -1.53      4.63
115  1Summer   2.97      3.14      -0.18       4.38       -1.42      4.54
116  1Summer   3.31      3.74      -0.42       4.54       -1.22      4.74
117  1Summer   3.47      3.69      -0.22       4.53       -1.06      4.73
118  1Summer   3.29      3.68      -0.39       4.51       -1.22      4.72
119  1Summer   3.40      3.67      -0.27       4.50       -1.10      4.71
120  1Summer   3.32      3.63      -0.31       4.47       -1.15      4.68
121  1Summer   3.65      3.86      -0.21       4.22       -0.57      4.63
122  1Summer   3.87      3.92      -0.05       4.25       -0.38      4.62
123  1Summer   4.44      3.93       0.51       4.59       -0.15      4.83
124  1Summer   3.47      3.96      -0.49       4.74       -1.27      4.91
125  1Summer   3.32      3.89      -0.57       4.22       -0.90      4.49
126  1Summer   3.26      3.75      -0.49       4.13       -0.87      4.42
127  1Summer   3.79      3.82      -0.03       4.30       -0.51      4.51
128  1Summer   3.84      3.92      -0.08       4.34       -0.50      4.53
129  1Summer   4.30      4.00       0.30       4.56       -0.26      4.70
130  1Summer   3.58      3.83      -0.25       4.18       -0.60      4.41
131  1Summer   3.50      3.77      -0.27       4.18       -0.68      4.38
132  1Summer   3.55      3.42       0.13       3.83       -0.28      3.76
133  1Summer   3.58      3.47       0.11       3.96       -0.38      3.87
134  1Summer   3.54      3.46       0.07       3.95       -0.41      3.87
135  1Summer   3.63      3.47       0.16       3.94       -0.31      3.87
136  1Summer   3.51      3.48       0.03       3.93       -0.42      3.87
137  1Summer   3.57      3.52       0.05       3.92       -0.34      3.88
138  1Summer   3.93      3.67       0.26       4.21       -0.28      4.50
139  1Summer   3.83      3.71       0.11       4.33       -0.50      4.69
140  1Summer   3.94      3.71       0.22       4.33       -0.39      4.69
141  1Summer   3.78      3.71       0.07       4.32       -0.54      4.69
142  1Summer   3.88      3.70       0.18       4.32       -0.44      4.68
143  1Summer   3.89      3.66       0.23       4.31       -0.42      4.58
144  1Summer   3.52      3.65      -0.13       4.18       -0.66      4.44
145  1Summer   3.86      3.52       0.34       4.43       -0.56      4.67
146  1Summer   3.81      3.87      -0.07       4.39       -0.59      4.75
147  1Summer   3.38      3.55      -0.18       4.49       -1.11      4.61
148  1Summer   3.27      3.56      -0.29       4.21       -0.94      4.43
149    2Fall   4.15      3.55       0.59       4.07        0.08      4.38
150    2Fall   4.23      3.62       0.61       4.22        0.01      4.57
151    2Fall   4.46      3.62       0.85       4.22        0.24      4.58
152    2Fall   4.25      3.61       0.64       4.21        0.05      4.57
153    2Fall   4.07      3.60       0.47       4.17       -0.10      4.55
154    2Fall   4.15      3.55       0.61       4.03        0.12      4.45
155    2Fall   4.56      3.49       1.07       4.39        0.18      4.60
156    2Fall   4.47      3.53       0.94       4.53       -0.06      4.68
157    2Fall   4.50      3.55       0.95       4.56       -0.06      4.72
158    2Fall   4.59      3.56       1.03       4.57        0.01      4.74
159    2Fall   4.52      3.56       0.96       4.54       -0.02      4.74
160    2Fall   4.51      3.56       0.95       4.57       -0.06      4.72
161    2Fall   3.83      3.59       0.23       4.16       -0.33      4.39
162    2Fall   4.09      3.63       0.46       4.22       -0.13      4.43
163    2Fall   4.12      3.63       0.49       4.20       -0.08      4.43
164    2Fall   4.43      3.64       0.79       4.21        0.22      4.44
165    2Fall   4.04      3.64       0.40       4.23       -0.19      4.44
166    2Fall   4.13      3.64       0.49       4.21       -0.08      4.39
167    2Fall   4.55      3.55       0.99       4.35        0.19      4.54
168    2Fall   4.42      3.55       0.87       4.38        0.04      4.59
169    2Fall   4.09      3.55       0.54       4.39       -0.30      4.60
170    2Fall   4.51      3.56       0.95       4.44        0.06      4.63
171    2Fall   4.43      3.55       0.87       4.45       -0.03      4.63
172    2Fall   4.43      3.53       0.90       4.47       -0.04      4.62
173    2Fall   4.40      3.70       0.69       4.47       -0.07      4.69
174    2Fall   4.47      3.72       0.75       4.44        0.02      4.65
175    2Fall   4.50      3.87       0.63       4.52       -0.02      4.75
176    2Fall   4.59      3.88       0.72       4.57        0.03      4.78
177    2Fall   4.46      3.79       0.67       4.54       -0.08      4.76
178    2Fall   4.43      3.73       0.69       4.53       -0.11      4.74
179    2Fall   3.90      3.15       0.75       4.24       -0.34      4.38
180    2Fall   3.91      3.15       0.76       4.25       -0.34      4.40
181    2Fall   4.00      3.16       0.84       4.26       -0.26      4.40
182    2Fall   3.95      3.16       0.79       4.22       -0.27      4.40
183    2Fall   4.15      3.16       0.99       4.21       -0.06      4.39
184    2Fall   4.26      3.19       1.07       4.28       -0.02      4.41
185    2Fall   4.19      3.00       1.19       4.36       -0.17      4.51
186    2Fall   4.25      3.13       1.13       4.38       -0.12      4.54
187    2Fall   4.24      3.20       1.04       4.57       -0.33      4.69
188    2Fall   4.37      3.20       1.17       4.54       -0.17      4.67
189    2Fall   4.15      3.16       1.00       4.28       -0.12      4.51
190    2Fall   4.18      3.03       1.15       4.14        0.04      4.42
191    2Fall   3.62      3.46       0.16       3.83       -0.21      4.07
192    2Fall   3.58      3.49       0.09       3.82       -0.24      4.11
193    2Fall   3.58      3.50       0.08       3.81       -0.23      4.12
194    2Fall   3.66      3.52       0.14       3.82       -0.16      4.14
195    2Fall   3.73      3.54       0.19       3.85       -0.12      4.19
196    2Fall   3.70      3.62       0.09       3.99       -0.28      4.28
197    2Fall   3.88      3.22       0.67       3.83        0.06      4.28
198    2Fall   3.81      3.27       0.54       3.92       -0.11      4.37
199    2Fall   3.80      3.27       0.53       3.93       -0.13      4.38
200    2Fall   3.57      3.28       0.29       3.93       -0.36      4.38
201    2Fall   3.67      3.28       0.39       3.92       -0.25      4.37
202    2Fall   3.76      3.25       0.51       3.84       -0.08      4.27
203    2Fall   4.00      3.71       0.29       4.16       -0.16      4.28
204    2Fall   4.08      3.66       0.41       4.11       -0.04      4.27
205    2Fall   4.01      3.65       0.36       4.09       -0.08      4.26
206    2Fall   3.83      3.64       0.18       4.07       -0.25      4.25
207    2Fall   3.93      3.61       0.31       4.01       -0.09      4.20
208    2Fall   3.92      3.55       0.37       3.92        0.00      4.03
209    2Fall   4.03      2.52       1.51       3.83        0.19      4.04
210    2Fall   4.50      3.36       1.14       4.53       -0.03      4.80
211    2Fall   4.36      3.39       0.98       4.33        0.03      4.52
212    2Fall   3.99      3.53       0.46       4.23       -0.24      4.45
213    2Fall   4.10      3.55       0.55       4.33       -0.23      4.51
214    2Fall   4.19      3.54       0.65       4.28       -0.09      4.50
215    2Fall   4.10      3.55       0.55       4.29       -0.19      4.50
216    2Fall   4.00      3.55       0.46       4.30       -0.29      4.49
217    2Fall   3.82      3.51       0.31       4.16       -0.34      4.38
218    2Fall   4.44      3.77       0.67       4.54       -0.09      4.81
219    2Fall   4.73      3.90       0.83       4.59        0.14      4.85
220    2Fall   4.92      3.90       1.02       4.96       -0.04      5.14
221    2Fall   4.83      3.88       0.95       4.93       -0.10      5.12
222    2Fall   4.79      3.89       0.89       4.60        0.19      4.84
223    2Fall   4.62      3.79       0.83       4.55        0.07      4.77
224    2Fall   4.71      3.60       1.11       4.47        0.25      4.71
225    2Fall   4.43      3.61       0.82       4.55       -0.12      4.74
226    2Fall   4.70      3.60       1.10       4.54        0.16      4.73
227    2Fall   4.48      3.59       0.88       4.51       -0.04      4.72
228    2Fall   4.49      3.59       0.91       4.48        0.01      4.71
229    2Fall   4.58      3.58       1.00       4.47        0.10      4.66
230    2Fall   4.51      3.51       0.99       4.49        0.02      4.64
231    2Fall   4.59      3.56       1.03       4.60       -0.02      4.73
232    2Fall   4.64      3.56       1.08       4.60        0.04      4.73
233    2Fall   4.58      3.56       1.03       4.56        0.03      4.71
234    2Fall   4.58      3.56       1.03       4.54        0.05      4.71
235    2Fall   4.52      3.53       1.00       4.39        0.13      4.62
236    2Fall   3.81      2.92       0.90       3.82       -0.01      4.22
237    2Fall   4.01      2.97       1.04       3.97        0.04      4.34
238    2Fall   4.19      2.98       1.21       3.99        0.20      4.35
239    2Fall   3.99      2.99       1.01       4.01       -0.02      4.36
240    2Fall   3.93      2.99       0.94       4.04       -0.10      4.36
241    2Fall   4.01      2.98       1.03       4.06       -0.06      4.30
242    2Fall   4.31      3.45       0.85       4.49       -0.18      4.63
243    2Fall   4.38      3.45       0.93       4.51       -0.12      4.69
244    2Fall   4.94      3.45       1.50       4.50        0.44      4.69
245    2Fall   4.09      3.44       0.66       4.51       -0.42      4.70
246    2Fall   4.28      3.43       0.85       4.49       -0.21      4.68
247    2Fall   4.27      3.36       0.92       4.35       -0.08      4.52
248    2Fall   4.34      3.37       0.98       4.40       -0.06      4.56
249    2Fall   4.38      3.36       1.03       4.44       -0.06      4.59
250    2Fall   4.83      3.34       1.49       4.43        0.40      4.58
251    2Fall   4.42      3.32       1.10       4.39        0.03      4.56
252    2Fall   4.32      3.31       1.01       4.36       -0.04      4.55
253    2Fall   4.31      3.25       1.06       4.24        0.08      4.47
254    2Fall   4.26      3.02       1.24       4.32       -0.06      4.52
255    2Fall   4.36      3.84       0.52       4.37       -0.01      4.74
256    2Fall   3.86      2.37       1.49       3.72        0.14      3.66
257    2Fall   4.03      3.63       0.39       4.12       -0.09      4.33
258    2Fall   4.25      3.60       0.65       4.33       -0.08      4.64
259    2Fall   3.97      2.42       1.56       3.91        0.06      4.00
260    2Fall   3.89      2.34       1.55       3.78        0.11      3.84
261    2Fall   3.93      2.32       1.61       3.74        0.19      3.78
262    2Fall   3.96      2.27       1.69       3.64        0.32      3.69
263    2Fall   4.09      2.22       1.87       3.56        0.53      3.61
264    2Fall   3.93      3.12       0.80       4.13       -0.21      4.35
265    2Fall   4.44      3.26       1.18       4.26        0.18      4.40
266    2Fall   4.56      3.30       1.26       4.29        0.28      4.42
267    2Fall   4.39      3.30       1.10       4.54       -0.15      4.63
268    2Fall   4.38      3.29       1.09       4.37        0.02      4.51
269    2Fall   4.36      3.14       1.22       4.38       -0.02      4.54
270    2Fall   4.57      3.74       0.84       4.54        0.04      4.74
271    2Fall   4.67      3.69       0.98       4.53        0.14      4.73
272    2Fall   4.60      3.68       0.92       4.51        0.08      4.72
273    2Fall   4.67      3.67       1.00       4.50        0.17      4.71
274    2Fall   4.46      3.63       0.83       4.47        0.00      4.68
275    2Fall   4.55      3.86       0.69       4.22        0.33      4.63
276    2Fall   4.57      3.92       0.65       4.25        0.32      4.62
277    2Fall   5.00      3.93       1.06       4.59        0.41      4.83
278    2Fall   4.83      3.96       0.87       4.74        0.09      4.91
279    2Fall   4.51      3.89       0.62       4.22        0.29      4.49
280    2Fall   4.31      3.75       0.56       4.13        0.19      4.42
281    2Fall   4.38      3.82       0.56       4.30        0.08      4.51
282    2Fall   4.12      3.83       0.29       4.18       -0.06      4.41
283    2Fall   4.11      3.77       0.35       4.18       -0.07      4.38
284    2Fall   4.03      3.42       0.61       3.83        0.20      3.76
285    2Fall   3.98      3.47       0.51       3.96        0.02      3.87
286    2Fall   3.96      3.46       0.50       3.95        0.01      3.87
287    2Fall   3.87      3.47       0.39       3.94       -0.07      3.87
288    2Fall   4.01      3.48       0.54       3.93        0.08      3.87
289    2Fall   3.98      3.52       0.46       3.92        0.06      3.88
290    2Fall   4.54      3.67       0.87       4.21        0.33      4.50
291    2Fall   4.63      3.71       0.92       4.33        0.30      4.69
292    2Fall   4.67      3.71       0.96       4.33        0.34      4.69
293    2Fall   4.34      3.71       0.63       4.32        0.02      4.69
294    2Fall   4.62      3.70       0.92       4.32        0.30      4.68
295    2Fall   4.58      3.66       0.92       4.31        0.27      4.58
296    2Fall   4.36      3.65       0.70       4.18        0.17      4.44
297    2Fall   4.79      3.52       1.27       4.43        0.36      4.67
298    2Fall   4.51      3.87       0.64       4.39        0.12      4.75
299    2Fall   4.50      3.55       0.95       4.49        0.02      4.61
300    2Fall   4.41      3.56       0.85       4.21        0.20      4.43
301  3Winter   4.04      3.67       0.37       4.12       -0.08      4.33
302  3Winter   4.31      3.55       0.76       4.07        0.25      4.38
303  3Winter   4.39      3.62       0.78       4.22        0.17      4.57
304  3Winter   4.55      3.62       0.93       4.22        0.33      4.58
305  3Winter   4.50      3.61       0.89       4.21        0.30      4.57
306  3Winter   4.34      3.60       0.74       4.17        0.17      4.55
307  3Winter   4.29      3.55       0.74       4.03        0.26      4.45
308  3Winter   4.68      3.67       1.01       4.32        0.36      4.51
309  3Winter   4.66      3.79       0.87       4.34        0.33      4.64
310  3Winter   4.82      3.49       1.33       4.39        0.43      4.60
311  3Winter   4.73      3.53       1.19       4.53        0.20      4.68
312  3Winter   4.83      3.55       1.28       4.56        0.27      4.72
313  3Winter   4.86      3.56       1.30       4.57        0.29      4.74
314  3Winter   4.78      3.56       1.22       4.57        0.21      4.72
315  3Winter   4.01      3.59       0.42       4.16       -0.14      4.39
316  3Winter   4.29      3.63       0.66       4.22        0.07      4.43
317  3Winter   4.34      3.63       0.70       4.20        0.13      4.43
318  3Winter   4.62      3.64       0.98       4.21        0.40      4.44
319  3Winter   4.43      3.64       0.79       4.23        0.21      4.44
320  3Winter   4.43      3.64       0.79       4.21        0.22      4.39
321  3Winter   4.61      3.55       1.06       4.35        0.26      4.54
322  3Winter   4.63      3.55       1.07       4.38        0.25      4.59
323  3Winter   4.69      3.55       1.13       4.39        0.30      4.60
324  3Winter   4.82      3.56       1.26       4.44        0.37      4.63
325  3Winter   4.70      3.55       1.15       4.45        0.25      4.63
326  3Winter   4.42      3.53       0.89       4.47       -0.05      4.62
327  3Winter   4.28      3.70       0.58       4.47       -0.19      4.69
328  3Winter   4.61      3.72       0.90       4.44        0.17      4.65
329  3Winter   4.71      3.87       0.84       4.52        0.19      4.75
330  3Winter   4.81      3.88       0.93       4.57        0.24      4.78
331  3Winter   4.59      3.79       0.79       4.54        0.05      4.76
332  3Winter   4.66      3.73       0.93       4.53        0.13      4.74
333  3Winter   4.13      3.15       0.98       4.24       -0.11      4.38
334  3Winter   4.09      3.15       0.94       4.25       -0.16      4.40
335  3Winter   4.20      3.16       1.04       4.26       -0.06      4.40
336  3Winter   4.17      3.16       1.01       4.22       -0.05      4.40
337  3Winter   4.32      3.16       1.16       4.21        0.11      4.39
338  3Winter   4.34      3.19       1.15       4.28        0.06      4.41
339  3Winter   4.39      3.00       1.39       4.36        0.03      4.51
340  3Winter   4.44      3.13       1.31       4.38        0.06      4.54
341  3Winter   4.45      3.20       1.25       4.57       -0.12      4.69
342  3Winter   4.45      3.20       1.25       4.54       -0.09      4.67
343  3Winter   4.27      3.16       1.11       4.28       -0.01      4.51
344  3Winter   4.27      3.03       1.24       4.14        0.13      4.42
345  3Winter   3.87      3.46       0.41       3.83        0.04      4.07
346  3Winter   3.88      3.49       0.39       3.82        0.07      4.11
347  3Winter   3.91      3.50       0.41       3.81        0.10      4.12
348  3Winter   3.95      3.52       0.43       3.82        0.13      4.14
349  3Winter   3.99      3.54       0.45       3.85        0.14      4.19
350  3Winter   3.98      3.62       0.36       3.99       -0.01      4.28
351  3Winter   4.30      3.71       0.59       4.16        0.14      4.28
352  3Winter   4.22      3.66       0.56       4.11        0.11      4.27
353  3Winter   4.21      3.65       0.56       4.09        0.13      4.26
354  3Winter   4.09      3.64       0.45       4.07        0.02      4.25
355  3Winter   4.10      3.61       0.48       4.01        0.09      4.20
356  3Winter   4.15      3.55       0.60       3.92        0.23      4.03
357  3Winter   4.33      2.52       1.81       3.83        0.50      4.04
358  3Winter   4.63      3.46       1.17       4.74       -0.11      4.83
359  3Winter   4.75      3.36       1.39       4.53        0.22      4.80
360  3Winter   4.65      3.88       0.77       4.43        0.22      4.64
361  3Winter   4.18      3.53       0.65       4.23       -0.05      4.45
362  3Winter   4.31      3.55       0.76       4.33       -0.01      4.51
363  3Winter   4.34      3.54       0.80       4.28        0.06      4.50
364  3Winter   4.20      3.55       0.66       4.30       -0.09      4.49
365  3Winter   4.06      3.51       0.55       4.16       -0.11      4.38
366  3Winter   4.91      3.77       1.14       4.54        0.37      4.81
367  3Winter   4.91      3.90       1.02       4.59        0.32      4.85
368  3Winter   5.07      3.90       1.17       4.96        0.11      5.14
369  3Winter   4.97      3.88       1.09       4.93        0.04      5.12
370  3Winter   4.88      3.89       0.98       4.60        0.28      4.84
371  3Winter   4.81      3.79       1.02       4.55        0.26      4.77
372  3Winter   4.83      3.60       1.23       4.47        0.36      4.71
373  3Winter   4.83      3.61       1.22       4.55        0.28      4.74
374  3Winter   4.92      3.60       1.31       4.54        0.38      4.73
375  3Winter   4.90      3.59       1.31       4.51        0.39      4.72
376  3Winter   4.84      3.59       1.26       4.48        0.36      4.71
377  3Winter   4.82      3.58       1.24       4.47        0.35      4.66
378  3Winter   4.78      3.51       1.26       4.49        0.29      4.64
379  3Winter   4.72      3.56       1.16       4.60        0.11      4.73
380  3Winter   4.88      3.56       1.31       4.60        0.28      4.73
381  3Winter   4.75      3.56       1.19       4.56        0.19      4.71
382  3Winter   4.82      3.56       1.27       4.54        0.29      4.71
383  3Winter   4.60      3.70       0.90       3.90        0.70      4.38
384  3Winter   4.65      3.76       0.89       3.98        0.67      4.48
385  3Winter   4.72      3.78       0.94       4.00        0.72      4.50
386  3Winter   4.82      3.81       1.01       4.04        0.78      4.52
387  3Winter   4.79      3.84       0.95       4.08        0.71      4.54
388  3Winter   4.82      3.90       0.92       4.17        0.65      4.55
389  3Winter   4.45      3.60       0.85       4.16        0.29      4.57
390  3Winter   4.46      3.60       0.87       4.16        0.30      4.56
391  3Winter   4.56      3.62       0.95       4.22        0.35      4.61
392  3Winter   4.40      3.60       0.80       4.20        0.20      4.59
393  3Winter   4.38      3.60       0.78       4.27        0.11      4.54
394  3Winter   4.59      3.45       1.13       4.49        0.10      4.63
395  3Winter   4.65      3.45       1.20       4.51        0.14      4.69
396  3Winter   5.01      3.45       1.56       4.50        0.50      4.69
397  3Winter   4.56      3.44       1.12       4.51        0.05      4.70
398  3Winter   4.59      3.43       1.16       4.49        0.10      4.68
399  3Winter   4.49      3.36       1.13       4.35        0.14      4.52
400  3Winter   4.59      3.37       1.22       4.40        0.19      4.56
401  3Winter   4.55      3.36       1.20       4.44        0.11      4.59
402  3Winter   4.89      3.34       1.55       4.43        0.47      4.58
403  3Winter   4.57      3.32       1.25       4.39        0.18      4.56
404  3Winter   4.51      3.31       1.20       4.36        0.15      4.55
405  3Winter   4.49      3.25       1.24       4.24        0.25      4.47
406  3Winter   4.52      3.02       1.50       4.32        0.20      4.52
407  3Winter   4.45      3.84       0.61       4.37        0.08      4.74
408  3Winter   4.02      2.37       1.64       3.72        0.30      3.66
409  3Winter   4.21      3.63       0.57       4.12        0.09      4.33
410  3Winter   4.52      3.60       0.92       4.33        0.18      4.64
411  3Winter   4.69      3.53       1.16       4.32        0.36      4.62
412  3Winter   4.74      3.91       0.83       4.49        0.25      4.69
413  3Winter   4.36      3.56       0.80       4.34        0.02      4.48
414  3Winter   4.25      3.51       0.74       4.16        0.09      4.37
415  3Winter   3.92      2.42       1.51       3.91        0.01      4.00
416  3Winter   3.96      2.34       1.62       3.78        0.18      3.84
417  3Winter   3.92      2.32       1.61       3.74        0.19      3.78
418  3Winter   3.91      2.27       1.64       3.64        0.27      3.69
419  3Winter   3.85      2.22       1.63       3.56        0.29      3.61
420  3Winter   4.47      3.12       1.35       4.13        0.34      4.35
421  3Winter   4.49      3.26       1.23       4.26        0.23      4.40
422  3Winter   4.64      3.30       1.34       4.29        0.35      4.42
423  3Winter   4.54      3.30       1.24       4.54       -0.01      4.63
424  3Winter   4.44      3.29       1.14       4.37        0.07      4.51
425  3Winter   4.44      3.14       1.29       4.38        0.05      4.54
426  3Winter   4.75      3.86       0.89       4.22        0.53      4.63
427  3Winter   4.73      3.92       0.81       4.25        0.48      4.62
428  3Winter   5.01      3.93       1.08       4.59        0.42      4.83
429  3Winter   5.00      3.96       1.04       4.74        0.26      4.91
430  3Winter   4.72      3.89       0.83       4.22        0.50      4.49
431  3Winter   4.50      3.75       0.75       4.13        0.37      4.42
432  3Winter   4.58      3.82       0.77       4.30        0.28      4.51
433  3Winter   4.65      3.92       0.73       4.34        0.31      4.53
434  3Winter   5.10      4.00       1.10       4.56        0.54      4.70
435  3Winter   4.69      3.98       0.70       4.52        0.16      4.67
436  3Winter   4.32      3.83       0.49       4.18        0.14      4.41
437  3Winter   4.22      3.77       0.45       4.18        0.04      4.38
438  3Winter   4.76      3.67       1.09       4.21        0.55      4.50
439  3Winter   4.82      3.71       1.10       4.33        0.49      4.69
440  3Winter   4.86      3.71       1.15       4.33        0.54      4.69
441  3Winter   4.78      3.71       1.07       4.32        0.46      4.69
442  3Winter   4.79      3.70       1.08       4.32        0.46      4.68
443  3Winter   4.79      3.66       1.13       4.31        0.48      4.58
444  3Winter   4.71      3.65       1.06       4.18        0.53      4.44
445  3Winter   4.98      3.52       1.45       4.43        0.55      4.67
446  3Winter   4.74      3.55       1.19       4.49        0.25      4.61
447  3Winter   4.61      3.56       1.05       4.21        0.40      4.43
448  3Winter   4.12      3.57       0.55       4.00        0.11      4.06
449  3Winter   4.26      3.91       0.35       4.23        0.02      4.24
    resids_win
1        -0.90
2        -0.96
3        -0.76
4        -1.05
5        -0.96
6        -0.96
7        -1.07
8        -1.25
9        -1.17
10       -1.31
11       -1.33
12       -1.35
13       -0.68
14       -0.73
15       -0.75
16       -0.65
17       -0.74
18       -0.58
19       -0.93
20       -0.90
21       -1.03
22       -1.00
23       -1.26
24       -1.10
25       -0.95
26       -0.68
27       -0.71
28       -1.02
29       -0.89
30       -0.88
31       -0.98
32       -1.06
33       -1.05
34       -1.13
35       -0.87
36       -0.88
37       -1.53
38       -1.38
39       -1.49
40       -1.13
41       -1.42
42       -1.29
43       -0.51
44       -0.61
45       -0.58
46       -0.62
47       -0.63
48       -0.83
49       -1.09
50       -1.11
51       -1.09
52       -1.17
53       -1.17
54       -1.03
55       -0.49
56       -0.66
57       -0.61
58       -0.71
59       -0.67
60       -0.48
61       -1.55
62       -1.48
63       -1.64
64       -1.10
65       -0.65
66       -0.78
67       -0.82
68       -0.79
69       -0.72
70       -0.79
71       -0.96
72       -1.54
73       -1.12
74       -1.29
75       -0.97
76       -1.05
77       -1.17
78       -1.21
79       -1.17
80       -1.13
81       -1.33
82       -1.10
83       -1.23
84       -1.25
85       -1.19
86       -1.34
87       -1.25
88       -0.91
89       -1.29
90       -1.53
91       -1.37
92       -1.38
93       -1.28
94       -0.65
95       -1.36
96       -1.20
97       -1.25
98       -0.58
99       -1.30
100      -1.19
101      -1.23
102      -1.39
103      -1.06
104      -1.42
105      -0.59
106      -0.81
107      -1.90
108      -1.54
109      -1.56
110      -1.99
111      -1.48
112      -1.06
113      -0.80
114      -1.62
115      -1.58
116      -1.43
117      -1.26
118      -1.43
119      -1.31
120      -1.36
121      -0.98
122      -0.76
123      -0.39
124      -1.44
125      -1.17
126      -1.16
127      -0.73
128      -0.68
129      -0.40
130      -0.83
131      -0.88
132      -0.21
133      -0.29
134      -0.34
135      -0.24
136      -0.35
137      -0.31
138      -0.57
139      -0.86
140      -0.76
141      -0.91
142      -0.80
143      -0.69
144      -0.92
145      -0.81
146      -0.94
147      -1.23
148      -1.16
149      -0.24
150      -0.34
151      -0.12
152      -0.32
153      -0.48
154      -0.29
155      -0.04
156      -0.21
157      -0.21
158      -0.15
159      -0.22
160      -0.20
161      -0.56
162      -0.34
163      -0.31
164       0.00
165      -0.40
166      -0.25
167       0.01
168      -0.17
169      -0.51
170      -0.12
171      -0.21
172      -0.19
173      -0.29
174      -0.19
175      -0.24
176      -0.18
177      -0.30
178      -0.32
179      -0.48
180      -0.49
181      -0.41
182      -0.45
183      -0.24
184      -0.16
185      -0.32
186      -0.29
187      -0.45
188      -0.30
189      -0.36
190      -0.24
191      -0.45
192      -0.53
193      -0.54
194      -0.48
195      -0.46
196      -0.58
197      -0.39
198      -0.56
199      -0.58
200      -0.81
201      -0.70
202      -0.51
203      -0.28
204      -0.19
205      -0.25
206      -0.42
207      -0.28
208      -0.11
209      -0.02
210      -0.30
211      -0.16
212      -0.46
213      -0.41
214      -0.31
215      -0.40
216      -0.49
217      -0.56
218      -0.37
219      -0.12
220      -0.22
221      -0.28
222      -0.05
223      -0.14
224       0.00
225      -0.31
226      -0.04
227      -0.25
228      -0.21
229      -0.08
230      -0.13
231      -0.14
232      -0.08
233      -0.13
234      -0.12
235      -0.10
236      -0.41
237      -0.33
238      -0.16
239      -0.36
240      -0.43
241      -0.29
242      -0.33
243      -0.30
244       0.26
245      -0.61
246      -0.40
247      -0.25
248      -0.22
249      -0.20
250       0.25
251      -0.14
252      -0.22
253      -0.15
254      -0.25
255      -0.38
256       0.20
257      -0.30
258      -0.39
259      -0.03
260       0.05
261       0.15
262       0.27
263       0.49
264      -0.43
265       0.03
266       0.14
267      -0.24
268      -0.13
269      -0.18
270      -0.17
271      -0.06
272      -0.12
273      -0.04
274      -0.21
275      -0.08
276      -0.05
277       0.17
278      -0.08
279       0.02
280      -0.11
281      -0.13
282      -0.29
283      -0.27
284       0.27
285       0.11
286       0.09
287      -0.01
288       0.15
289       0.10
290       0.04
291      -0.06
292      -0.03
293      -0.35
294      -0.06
295       0.00
296      -0.08
297       0.12
298      -0.23
299      -0.11
300      -0.03
301      -0.29
302      -0.07
303      -0.18
304      -0.03
305      -0.07
306      -0.22
307      -0.16
308       0.17
309       0.02
310       0.21
311       0.04
312       0.11
313       0.12
314       0.07
315      -0.37
316      -0.14
317      -0.09
318       0.18
319       0.00
320       0.04
321       0.08
322       0.04
323       0.09
324       0.19
325       0.07
326      -0.19
327      -0.41
328      -0.04
329      -0.04
330       0.03
331      -0.17
332      -0.08
333      -0.26
334      -0.31
335      -0.21
336      -0.23
337      -0.07
338      -0.07
339      -0.11
340      -0.10
341      -0.24
342      -0.22
343      -0.24
344      -0.15
345      -0.19
346      -0.22
347      -0.20
348      -0.19
349      -0.19
350      -0.30
351       0.02
352      -0.05
353      -0.04
354      -0.16
355      -0.10
356       0.12
357       0.29
358      -0.21
359      -0.05
360       0.01
361      -0.27
362      -0.20
363      -0.16
364      -0.29
365      -0.33
366       0.10
367       0.06
368      -0.07
369      -0.15
370       0.04
371       0.04
372       0.12
373       0.09
374       0.18
375       0.18
376       0.14
377       0.16
378       0.14
379      -0.01
380       0.15
381       0.04
382       0.12
383       0.22
384       0.17
385       0.22
386       0.30
387       0.25
388       0.27
389      -0.12
390      -0.10
391      -0.05
392      -0.19
393      -0.16
394      -0.04
395      -0.04
396       0.32
397      -0.15
398      -0.09
399      -0.03
400       0.03
401      -0.03
402       0.32
403       0.01
404      -0.04
405       0.02
406       0.01
407      -0.29
408       0.36
409      -0.12
410      -0.13
411       0.07
412       0.05
413      -0.12
414      -0.11
415      -0.08
416       0.12
417       0.14
418       0.22
419       0.25
420       0.12
421       0.08
422       0.22
423      -0.10
424      -0.08
425      -0.11
426       0.12
427       0.11
428       0.18
429       0.09
430       0.24
431       0.08
432       0.07
433       0.13
434       0.40
435       0.01
436      -0.09
437      -0.16
438       0.26
439       0.12
440       0.17
441       0.09
442       0.10
443       0.21
444       0.27
445       0.31
446       0.13
447       0.17
448       0.06
449       0.01</code></pre>
</div>
</div>
<p>Now we add prediction intervals:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="co">#-----in-sample prediction intervals-----</span></span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a><span class="co"># first get the prediction interval for each season and bind it to the</span></span>
<span id="cb13-4"><a href="#cb13-4" aria-hidden="true" tabindex="-1"></a><span class="co"># season-specific subset of the full dataset</span></span>
<span id="cb13-5"><a href="#cb13-5" aria-hidden="true" tabindex="-1"></a><span class="co"># </span><span class="al">NOTE</span><span class="co">:  We are assuming the two datasets are in the same order when we cbind!</span></span>
<span id="cb13-6"><a href="#cb13-6" aria-hidden="true" tabindex="-1"></a><span class="co"># It is good practice to check and not assume this is correct.</span></span>
<span id="cb13-7"><a href="#cb13-7" aria-hidden="true" tabindex="-1"></a><span class="co"># R gives a warning about the interpretation of these prediction intervals when</span></span>
<span id="cb13-8"><a href="#cb13-8" aria-hidden="true" tabindex="-1"></a><span class="co"># the data to generate the model are the same ones to do prediction.  This</span></span>
<span id="cb13-9"><a href="#cb13-9" aria-hidden="true" tabindex="-1"></a><span class="co"># warning does not appear when the predictions are out of sample (see next</span></span>
<span id="cb13-10"><a href="#cb13-10" aria-hidden="true" tabindex="-1"></a><span class="co"># chunk).</span></span>
<span id="cb13-11"><a href="#cb13-11" aria-hidden="true" tabindex="-1"></a>summer <span class="ot">&lt;-</span> <span class="fu">cbind</span>(snapshot[snapshot<span class="sc">$</span>season<span class="sc">==</span><span class="dv">1</span>,],<span class="fu">predict</span>(lm_summer,<span class="at">interval=</span><span class="st">"prediction"</span>))</span>
<span id="cb13-12"><a href="#cb13-12" aria-hidden="true" tabindex="-1"></a>fall <span class="ot">&lt;-</span> <span class="fu">cbind</span>(snapshot[snapshot<span class="sc">$</span>season<span class="sc">==</span><span class="dv">2</span>,],<span class="fu">predict</span>(lm_fall,<span class="at">interval=</span><span class="st">"prediction"</span>))</span>
<span id="cb13-13"><a href="#cb13-13" aria-hidden="true" tabindex="-1"></a>winter <span class="ot">&lt;-</span> <span class="fu">cbind</span>(snapshot[snapshot<span class="sc">$</span>season<span class="sc">==</span><span class="dv">3</span>,],<span class="fu">predict</span>(lm_winter,<span class="at">interval=</span><span class="st">"prediction"</span>))</span>
<span id="cb13-14"><a href="#cb13-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-15"><a href="#cb13-15" aria-hidden="true" tabindex="-1"></a><span class="co"># then combine the dataset into one big tibble</span></span>
<span id="cb13-16"><a href="#cb13-16" aria-hidden="true" tabindex="-1"></a>allseas_in <span class="ot">&lt;-</span> <span class="fu">rbind</span>(summer, fall, winter) <span class="sc">%&gt;%</span> <span class="fu">as_tibble</span>()</span>
<span id="cb13-17"><a href="#cb13-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-18"><a href="#cb13-18" aria-hidden="true" tabindex="-1"></a><span class="co"># now use dplyr to rename the predictions (the predict function gives default</span></span>
<span id="cb13-19"><a href="#cb13-19" aria-hidden="true" tabindex="-1"></a><span class="co"># variable names)</span></span>
<span id="cb13-20"><a href="#cb13-20" aria-hidden="true" tabindex="-1"></a>allseas_in <span class="ot">&lt;-</span> <span class="fu">rename</span>(allseas_in, <span class="at">pred_in =</span> fit, <span class="at">lwr_in =</span> lwr, <span class="at">upr_in =</span> upr)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="co">#-----out-of-sample predictions-----</span></span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a><span class="co"># This example produces out-of-sample season-specific prediction intervals using</span></span>
<span id="cb14-4"><a href="#cb14-4" aria-hidden="true" tabindex="-1"></a><span class="co"># the previous season to predict the next one.  (Note you should think carefully</span></span>
<span id="cb14-5"><a href="#cb14-5" aria-hidden="true" tabindex="-1"></a><span class="co"># from a scientific perspective about how to approach out-of-sample predictions</span></span>
<span id="cb14-6"><a href="#cb14-6" aria-hidden="true" tabindex="-1"></a><span class="co"># like these.)</span></span>
<span id="cb14-7"><a href="#cb14-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-8"><a href="#cb14-8" aria-hidden="true" tabindex="-1"></a><span class="co"># get the prediction interval for each season </span></span>
<span id="cb14-9"><a href="#cb14-9" aria-hidden="true" tabindex="-1"></a>fall_preds_from_summer <span class="ot">&lt;-</span> </span>
<span id="cb14-10"><a href="#cb14-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">predict</span>(lm_summer, snapshot[snapshot<span class="sc">$</span>season <span class="sc">==</span> <span class="dv">2</span>,], <span class="at">interval =</span> <span class="st">"prediction"</span>)</span>
<span id="cb14-11"><a href="#cb14-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-12"><a href="#cb14-12" aria-hidden="true" tabindex="-1"></a>winter_preds_from_fall <span class="ot">&lt;-</span> </span>
<span id="cb14-13"><a href="#cb14-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">predict</span>(lm_fall, snapshot[snapshot<span class="sc">$</span>season <span class="sc">==</span> <span class="dv">3</span>,], <span class="at">interval =</span> <span class="st">"prediction"</span>)</span>
<span id="cb14-14"><a href="#cb14-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-15"><a href="#cb14-15" aria-hidden="true" tabindex="-1"></a>summer_preds_from_winter <span class="ot">&lt;-</span> </span>
<span id="cb14-16"><a href="#cb14-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">predict</span>(lm_winter, snapshot[snapshot<span class="sc">$</span>season <span class="sc">==</span> <span class="dv">1</span>,], <span class="at">interval =</span> <span class="st">"prediction"</span>)</span>
<span id="cb14-17"><a href="#cb14-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-18"><a href="#cb14-18" aria-hidden="true" tabindex="-1"></a><span class="co"># then combine the dataset into one big tibble and rename variables</span></span>
<span id="cb14-19"><a href="#cb14-19" aria-hidden="true" tabindex="-1"></a>allseas_out <span class="ot">&lt;-</span> <span class="fu">rbind</span>(summer_preds_from_winter, </span>
<span id="cb14-20"><a href="#cb14-20" aria-hidden="true" tabindex="-1"></a>                     fall_preds_from_summer,</span>
<span id="cb14-21"><a href="#cb14-21" aria-hidden="true" tabindex="-1"></a>                     winter_preds_from_fall) <span class="sc">%&gt;%</span> </span>
<span id="cb14-22"><a href="#cb14-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as_tibble</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb14-23"><a href="#cb14-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="at">pred_out =</span> fit, <span class="at">lwr_out =</span> lwr, <span class="at">upr_out =</span> upr)</span>
<span id="cb14-24"><a href="#cb14-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-25"><a href="#cb14-25" aria-hidden="true" tabindex="-1"></a><span class="co"># Bind "out" predictions to the previous dataset with "in" sample predictions</span></span>
<span id="cb14-26"><a href="#cb14-26" aria-hidden="true" tabindex="-1"></a><span class="co"># </span><span class="al">NOTE</span><span class="co">:  We assume the datasets are in the same order!</span></span>
<span id="cb14-27"><a href="#cb14-27" aria-hidden="true" tabindex="-1"></a>allseas_both <span class="ot">&lt;-</span> <span class="fu">cbind</span>(allseas_in, allseas_out)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Now evaluate the quality of the predictions. This is based on correlation between the prediction and the outcome. It is the R<sup>2</sup> for the best fit line of the relationship between the predictions and the data (<em>ln_nox</em> here). It does not account for the systematic bias in the predictions. Next week we will learn how to compute R<sup>2</sup> about the 1:1 line which also addresses the systematic bias of the predictions.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="co">#-----prediction assessment-----</span></span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a><span class="co"># summer in-sample</span></span>
<span id="cb15-4"><a href="#cb15-4" aria-hidden="true" tabindex="-1"></a><span class="fu">paste</span>(<span class="st">"summer in-sample R2:  "</span>, </span>
<span id="cb15-5"><a href="#cb15-5" aria-hidden="true" tabindex="-1"></a>      <span class="fu">with</span>(<span class="fu">subset</span>(allseas_both, season <span class="sc">==</span> <span class="dv">1</span>), <span class="fu">round</span>(<span class="fu">cor</span>(ln_nox, pred_in)<span class="sc">^</span><span class="dv">2</span>, <span class="dv">3</span>))) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "summer in-sample R2:   0.725"</code></pre>
</div>
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a><span class="co"># summer out-of-sample (from winter model)</span></span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a><span class="fu">paste</span>(<span class="st">"summer out-of-sample R2 (from winter model):  "</span>, </span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a>      <span class="fu">with</span>(<span class="fu">subset</span>(allseas_both, season <span class="sc">==</span> <span class="dv">1</span>), <span class="fu">round</span>(<span class="fu">cor</span>(ln_nox, pred_out)<span class="sc">^</span><span class="dv">2</span>,<span class="dv">3</span>)))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "summer out-of-sample R2 (from winter model):   0.247"</code></pre>
</div>
</div>
<p>Let’s look at what we mean by R<sup>2</sup> about the best fit line by plotting the data we correlated above and incorporating the best fit lines.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a><span class="co">#-----summer in and out of sample-----</span></span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-3"><a href="#cb19-3" aria-hidden="true" tabindex="-1"></a><span class="co"># plot the predictions vs. data for summer, both in-sample and out of sample</span></span>
<span id="cb19-4"><a href="#cb19-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-5"><a href="#cb19-5" aria-hidden="true" tabindex="-1"></a><span class="co"># get the range of the data to use as limits in the plots</span></span>
<span id="cb19-6"><a href="#cb19-6" aria-hidden="true" tabindex="-1"></a>r <span class="ot">&lt;-</span> allseas_both <span class="sc">%&gt;%</span> </span>
<span id="cb19-7"><a href="#cb19-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(season <span class="sc">==</span> <span class="dv">1</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb19-8"><a href="#cb19-8" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(pred_in, pred_out, ln_nox) <span class="sc">%&gt;%</span> </span>
<span id="cb19-9"><a href="#cb19-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">range</span>()</span>
<span id="cb19-10"><a href="#cb19-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-11"><a href="#cb19-11" aria-hidden="true" tabindex="-1"></a><span class="co"># in-sample plot</span></span>
<span id="cb19-12"><a href="#cb19-12" aria-hidden="true" tabindex="-1"></a>p_in <span class="ot">&lt;-</span> allseas_both <span class="sc">%&gt;%</span></span>
<span id="cb19-13"><a href="#cb19-13" aria-hidden="true" tabindex="-1"></a>    <span class="fu">filter</span>(season <span class="sc">==</span> <span class="dv">1</span>) <span class="sc">%&gt;%</span></span>
<span id="cb19-14"><a href="#cb19-14" aria-hidden="true" tabindex="-1"></a>    <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> pred_in, <span class="at">y =</span> ln_nox)) <span class="sc">+</span></span>
<span id="cb19-15"><a href="#cb19-15" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb19-16"><a href="#cb19-16" aria-hidden="true" tabindex="-1"></a>    <span class="fu">lims</span>(<span class="at">x =</span> <span class="fu">c</span>(r[<span class="dv">1</span>], r[<span class="dv">2</span>]), <span class="at">y =</span> <span class="fu">c</span>(r[<span class="dv">1</span>], r[<span class="dv">2</span>]) ) <span class="sc">+</span></span>
<span id="cb19-17"><a href="#cb19-17" aria-hidden="true" tabindex="-1"></a>    <span class="fu">coord_fixed</span>() <span class="sc">+</span></span>
<span id="cb19-18"><a href="#cb19-18" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_abline</span>(<span class="at">intercept =</span> <span class="dv">0</span>, <span class="at">slope =</span> <span class="dv">1</span>, <span class="at">color =</span> <span class="st">"blue"</span>) <span class="sc">+</span></span>
<span id="cb19-19"><a href="#cb19-19" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_smooth</span>(<span class="at">method =</span> <span class="st">"lm"</span>, <span class="at">se =</span> <span class="cn">FALSE</span>, <span class="at">color =</span> <span class="st">"red"</span>) <span class="sc">+</span></span>
<span id="cb19-20"><a href="#cb19-20" aria-hidden="true" tabindex="-1"></a>    <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"In-sample"</span>, </span>
<span id="cb19-21"><a href="#cb19-21" aria-hidden="true" tabindex="-1"></a>         <span class="at">x =</span> <span class="st">"In-sample predicted ln(NOx) (ln(ppb))"</span>,</span>
<span id="cb19-22"><a href="#cb19-22" aria-hidden="true" tabindex="-1"></a>         <span class="at">y =</span> <span class="st">"Observed ln(NOx) (ln(ppb))"</span></span>
<span id="cb19-23"><a href="#cb19-23" aria-hidden="true" tabindex="-1"></a>         ) <span class="sc">+</span> </span>
<span id="cb19-24"><a href="#cb19-24" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme_bw</span>()</span>
<span id="cb19-25"><a href="#cb19-25" aria-hidden="true" tabindex="-1"></a> </span>
<span id="cb19-26"><a href="#cb19-26" aria-hidden="true" tabindex="-1"></a><span class="co"># out-of-sample plot (predictions from the winter model)</span></span>
<span id="cb19-27"><a href="#cb19-27" aria-hidden="true" tabindex="-1"></a>p_out <span class="ot">&lt;-</span> allseas_both <span class="sc">%&gt;%</span></span>
<span id="cb19-28"><a href="#cb19-28" aria-hidden="true" tabindex="-1"></a>    <span class="fu">filter</span>(season <span class="sc">==</span> <span class="dv">1</span>) <span class="sc">%&gt;%</span></span>
<span id="cb19-29"><a href="#cb19-29" aria-hidden="true" tabindex="-1"></a>    <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x=</span>pred_out, <span class="at">y=</span>ln_nox)) <span class="sc">+</span></span>
<span id="cb19-30"><a href="#cb19-30" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb19-31"><a href="#cb19-31" aria-hidden="true" tabindex="-1"></a>    <span class="fu">lims</span>(<span class="at">x =</span> <span class="fu">c</span>(r[<span class="dv">1</span>], r[<span class="dv">2</span>]), <span class="at">y =</span> <span class="fu">c</span>(r[<span class="dv">1</span>], r[<span class="dv">2</span>]) ) <span class="sc">+</span></span>
<span id="cb19-32"><a href="#cb19-32" aria-hidden="true" tabindex="-1"></a>    <span class="fu">coord_fixed</span>() <span class="sc">+</span></span>
<span id="cb19-33"><a href="#cb19-33" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_abline</span>(<span class="at">intercept =</span> <span class="dv">0</span>, <span class="at">slope =</span> <span class="dv">1</span>, <span class="at">color =</span> <span class="st">"blue"</span>) <span class="sc">+</span></span>
<span id="cb19-34"><a href="#cb19-34" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_smooth</span>(<span class="at">method =</span> <span class="st">"lm"</span>, <span class="at">se =</span> <span class="cn">FALSE</span>, <span class="at">color =</span> <span class="st">"red"</span>) <span class="sc">+</span></span>
<span id="cb19-35"><a href="#cb19-35" aria-hidden="true" tabindex="-1"></a>    <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Out-of-sample (from winter model)"</span>, </span>
<span id="cb19-36"><a href="#cb19-36" aria-hidden="true" tabindex="-1"></a>         <span class="at">x =</span> <span class="st">"Out-of-sample predicted ln(NOx) (ln(ppb))"</span>,</span>
<span id="cb19-37"><a href="#cb19-37" aria-hidden="true" tabindex="-1"></a>         <span class="at">y =</span> <span class="st">"Observed ln(NOx) (ln(ppb))"</span></span>
<span id="cb19-38"><a href="#cb19-38" aria-hidden="true" tabindex="-1"></a>         ) <span class="sc">+</span> </span>
<span id="cb19-39"><a href="#cb19-39" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme_bw</span>()</span>
<span id="cb19-40"><a href="#cb19-40" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-41"><a href="#cb19-41" aria-hidden="true" tabindex="-1"></a><span class="co"># combine plots into one display</span></span>
<span id="cb19-42"><a href="#cb19-42" aria-hidden="true" tabindex="-1"></a><span class="fu">ggarrange</span>(p_in, p_out, <span class="at">ncol =</span> <span class="dv">2</span>, </span>
<span id="cb19-43"><a href="#cb19-43" aria-hidden="true" tabindex="-1"></a>          <span class="at">top =</span> <span class="st">"Summer Model ln(NOx) Predictions"</span>, </span>
<span id="cb19-44"><a href="#cb19-44" aria-hidden="true" tabindex="-1"></a>          <span class="at">bottom =</span> <span class="st">"Best fit line is red; 1:1 line is blue"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="Week3Lab_files/figure-html/summer.in.and.out.sample-1.png" class="img-fluid" width="672"></p>
</div>
</div>
</section>
<section id="practice-session" class="level1">
<h1>Practice Session</h1>
<p>This section covers basic practice to be completed during the lab.</p>
<p>Perform the following tasks:</p>
<ol type="1">
<li>Set up/decide your project for this lab.<br>
</li>
<li>Read in the snapshot data and get some basic understanding of its structure. See the lecture <code>.Rmd</code> file for some options.</li>
<li>Summarize <em>ln_nox</em>, the outcome variable of interest
<ol type="a">
<li>Summarize by season<br>
</li>
<li>Can you produce a nice summary figure of the data? Should they be on the log or the native scale? Is it useful to put multiple pollutants (NO, NOx, NO2) in the same figure?<br>
</li>
</ol></li>
<li>Replicate the season-specific models in Table 4 of <a href="https://doi.org/10.1016/j.atmosenv.2011.05.043">Mercer et al, 2011</a>. (Only focus on the LUR model results. Also we’ll talk about cross-validation in an upcoming week so recognize your in-sample R<sup>2</sup> should be a bit bigger and your RMSE should be a bit smaller than the values in the paper.)
<ol type="a">
<li>Compare your coefficient estimates and standard errors, as well as LUR R<sup>2</sup> and sample size. (Note: You may need to consider rounding in your comparison.)<br>
</li>
<li>Are all your terms parameterized the same as they are in the paper?<br>
</li>
</ol></li>
<li>Use the fall model to predict ln_nox in summer and vice versa.
<ol type="a">
<li>Assess the quality of the predictions. (Using the information from the lecture on regression for association, compute the R<sup>2</sup>, and plot the predictions and the prediction intervals.)<br>
</li>
<li>What have you learned? Does this flipping of models across seasons make sense scientifically? Why or why not?</li>
</ol></li>
</ol>
</section>
<section id="homework-exercises" class="level1">
<h1>Homework Exercises</h1>
<ol type="1">
<li>Describe the NOx variable. Develop one figure and one table to best capture your data and then write a paragraph describing what these show. (Doing both is for practice. In a peer-reviewed paper you will ordinarily only show one of these.) In the table, you may find it helpful to also include information on the covariates you use in your model(s) in this lab.<br>
</li>
<li>Using the terminology given in lecture, briefly discuss the fall season common LUR model results. Include in your discussion an interpretation for at least two terms in the fall season model.<br>
</li>
<li>Focusing on the common models in Table 4 of <a href="https://doi.org/10.1016/j.atmosenv.2011.05.043">Mercer et al, 2011</a>, think about how to use the data from all seasons at once to get season-specific parameter estimates. What terms do you need to incorporate the interactions?
<ol type="a">
<li>How is your interaction model different from fitting three separate season-specific models?</li>
</ol></li>
<li>Make table(s) and/or figure(s) summarizing your results for practice exercise 5. Discuss.</li>
</ol>
</section>
<section id="appendix" class="level1">
<h1>Appendix</h1>
<div class="cell">
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a><span class="co">#-----session information----</span></span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-3"><a href="#cb20-3" aria-hidden="true" tabindex="-1"></a><span class="co"># print R session information</span></span>
<span id="cb20-4"><a href="#cb20-4" aria-hidden="true" tabindex="-1"></a><span class="fu">sessionInfo</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>R version 4.3.1 (2023-06-16)
Platform: aarch64-apple-darwin20 (64-bit)
Running under: macOS Sonoma 14.6.1

Matrix products: default
BLAS:   /Library/Frameworks/R.framework/Versions/4.3-arm64/Resources/lib/libRblas.0.dylib 
LAPACK: /Library/Frameworks/R.framework/Versions/4.3-arm64/Resources/lib/libRlapack.dylib;  LAPACK version 3.11.0

locale:
[1] en_US.UTF-8/en_US.UTF-8/en_US.UTF-8/C/en_US.UTF-8/en_US.UTF-8

time zone: America/Los_Angeles
tzcode source: internal

attached base packages:
[1] stats     graphics  grDevices utils     datasets  methods   base     

other attached packages:
 [1] modelr_0.1.11   multcomp_1.4-26 TH.data_1.1-2   MASS_7.3-60    
 [5] survival_3.7-0  mvtnorm_1.3-1   egg_0.4.5       gridExtra_2.3  
 [9] ggplot2_3.5.1   purrr_1.0.2     dplyr_1.1.4     knitr_1.48     
[13] pacman_0.5.1   

loaded via a namespace (and not attached):
 [1] sandwich_3.1-1    utf8_1.2.4        generics_0.1.3    tidyr_1.3.1      
 [5] lattice_0.22-6    digest_0.6.37     magrittr_2.0.3    evaluate_1.0.0   
 [9] grid_4.3.1        fastmap_1.2.0     jsonlite_1.8.9    Matrix_1.6-1     
[13] backports_1.5.0   mgcv_1.9-1        fansi_1.0.6       scales_1.3.0     
[17] codetools_0.2-20  cli_3.6.3         rlang_1.1.4       munsell_0.5.1    
[21] splines_4.3.1     withr_3.0.1       yaml_2.3.10       tools_4.3.1      
[25] colorspace_2.1-1  broom_1.0.6       vctrs_0.6.5       R6_2.5.1         
[29] zoo_1.8-12        lifecycle_1.0.4   htmlwidgets_1.6.4 pkgconfig_2.0.3  
[33] pillar_1.9.0      gtable_0.3.5      glue_1.7.0        xfun_0.47        
[37] tibble_3.2.1      tidyselect_1.2.1  rstudioapi_0.16.0 farver_2.1.2     
[41] nlme_3.1-166      htmltools_0.5.8.1 rmarkdown_2.28    labeling_0.4.3   
[45] compiler_4.3.1   </code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a><span class="co">#-----setup-----</span></span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-3"><a href="#cb22-3" aria-hidden="true" tabindex="-1"></a><span class="co"># clear work space of all objects and unload all extra (non-base) packages</span></span>
<span id="cb22-4"><a href="#cb22-4" aria-hidden="true" tabindex="-1"></a><span class="fu">rm</span>(<span class="at">list =</span> <span class="fu">ls</span>(<span class="at">all =</span> <span class="cn">TRUE</span>))</span>
<span id="cb22-5"><a href="#cb22-5" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (<span class="sc">!</span><span class="fu">is.null</span>(<span class="fu">sessionInfo</span>()<span class="sc">$</span>otherPkgs)) {</span>
<span id="cb22-6"><a href="#cb22-6" aria-hidden="true" tabindex="-1"></a>    res <span class="ot">&lt;-</span> <span class="fu">suppressWarnings</span>(</span>
<span id="cb22-7"><a href="#cb22-7" aria-hidden="true" tabindex="-1"></a>        <span class="fu">lapply</span>(<span class="fu">paste</span>(<span class="st">'package:'</span>, <span class="fu">names</span>(<span class="fu">sessionInfo</span>()<span class="sc">$</span>otherPkgs), <span class="at">sep=</span><span class="st">""</span>),</span>
<span id="cb22-8"><a href="#cb22-8" aria-hidden="true" tabindex="-1"></a>               detach, <span class="at">character.only=</span><span class="cn">TRUE</span>, <span class="at">unload=</span><span class="cn">TRUE</span>, <span class="at">force=</span><span class="cn">TRUE</span>))</span>
<span id="cb22-9"><a href="#cb22-9" aria-hidden="true" tabindex="-1"></a>   </span>
<span id="cb22-10"><a href="#cb22-10" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb22-11"><a href="#cb22-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-12"><a href="#cb22-12" aria-hidden="true" tabindex="-1"></a><span class="co">#-----load libraries pacman-----</span></span>
<span id="cb22-13"><a href="#cb22-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-14"><a href="#cb22-14" aria-hidden="true" tabindex="-1"></a><span class="co"># Load pacman into memory, installing as needed</span></span>
<span id="cb22-15"><a href="#cb22-15" aria-hidden="true" tabindex="-1"></a>my_repo <span class="ot">&lt;-</span> <span class="st">'http://cran.r-project.org'</span></span>
<span id="cb22-16"><a href="#cb22-16" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (<span class="sc">!</span><span class="fu">require</span>(<span class="st">"pacman"</span>)) {<span class="fu">install.packages</span>(<span class="st">"pacman"</span>, <span class="at">repos =</span> my_repo)}</span>
<span id="cb22-17"><a href="#cb22-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-18"><a href="#cb22-18" aria-hidden="true" tabindex="-1"></a><span class="co"># Load the other packages, installing as needed.</span></span>
<span id="cb22-19"><a href="#cb22-19" aria-hidden="true" tabindex="-1"></a>pacman<span class="sc">::</span><span class="fu">p_load</span>(knitr, dplyr, purrr, ggplot2, egg, multcomp, modelr)</span>
<span id="cb22-20"><a href="#cb22-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-21"><a href="#cb22-21" aria-hidden="true" tabindex="-1"></a><span class="co">#-----directory organization and read data-----</span></span>
<span id="cb22-22"><a href="#cb22-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-23"><a href="#cb22-23" aria-hidden="true" tabindex="-1"></a><span class="co"># specify working directory</span></span>
<span id="cb22-24"><a href="#cb22-24" aria-hidden="true" tabindex="-1"></a>project_path <span class="ot">&lt;-</span> <span class="fu">getwd</span>()</span>
<span id="cb22-25"><a href="#cb22-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-26"><a href="#cb22-26" aria-hidden="true" tabindex="-1"></a><span class="co"># create "Datasets" directory if one does not already exist    </span></span>
<span id="cb22-27"><a href="#cb22-27" aria-hidden="true" tabindex="-1"></a><span class="fu">dir.create</span>(<span class="fu">file.path</span>(project_path,<span class="st">"Datasets"</span>), <span class="at">showWarnings=</span><span class="cn">FALSE</span>, <span class="at">recursive =</span> <span class="cn">TRUE</span>)</span>
<span id="cb22-28"><a href="#cb22-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-29"><a href="#cb22-29" aria-hidden="true" tabindex="-1"></a><span class="co"># specify data path</span></span>
<span id="cb22-30"><a href="#cb22-30" aria-hidden="true" tabindex="-1"></a>data_path <span class="ot">&lt;-</span> <span class="fu">file.path</span>(project_path,<span class="st">"Datasets"</span>)</span>
<span id="cb22-31"><a href="#cb22-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-32"><a href="#cb22-32" aria-hidden="true" tabindex="-1"></a><span class="co"># specify the file name and path</span></span>
<span id="cb22-33"><a href="#cb22-33" aria-hidden="true" tabindex="-1"></a>file_name <span class="ot">&lt;-</span> <span class="st">"allseasonsR.rds"</span></span>
<span id="cb22-34"><a href="#cb22-34" aria-hidden="true" tabindex="-1"></a>file_path <span class="ot">&lt;-</span> <span class="fu">file.path</span>(data_path, file_name)</span>
<span id="cb22-35"><a href="#cb22-35" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-36"><a href="#cb22-36" aria-hidden="true" tabindex="-1"></a><span class="co"># Download the file if it is not already present</span></span>
<span id="cb22-37"><a href="#cb22-37" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (<span class="sc">!</span><span class="fu">file.exists</span>(file_path)) {</span>
<span id="cb22-38"><a href="#cb22-38" aria-hidden="true" tabindex="-1"></a>    url <span class="ot">&lt;-</span> <span class="fu">paste</span>(<span class="st">"https://faculty.washington.edu/sheppard/envh556/Datasets"</span>, </span>
<span id="cb22-39"><a href="#cb22-39" aria-hidden="true" tabindex="-1"></a>                 file_name, <span class="at">sep =</span> <span class="st">'/'</span>)</span>
<span id="cb22-40"><a href="#cb22-40" aria-hidden="true" tabindex="-1"></a>    <span class="fu">download.file</span>(<span class="at">url =</span> url, <span class="at">destfile =</span> file_path)</span>
<span id="cb22-41"><a href="#cb22-41" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb22-42"><a href="#cb22-42" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-43"><a href="#cb22-43" aria-hidden="true" tabindex="-1"></a><span class="co"># Output a warning message if the file cannot be found</span></span>
<span id="cb22-44"><a href="#cb22-44" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (<span class="fu">file.exists</span>(file_path)) {</span>
<span id="cb22-45"><a href="#cb22-45" aria-hidden="true" tabindex="-1"></a>    snapshot<span class="ot">&lt;-</span><span class="fu">readRDS</span>(file_path)</span>
<span id="cb22-46"><a href="#cb22-46" aria-hidden="true" tabindex="-1"></a>} <span class="cf">else</span> <span class="fu">warning</span>(<span class="fu">paste</span>(<span class="st">"Can't find"</span>, file_name, <span class="st">"!"</span>))</span>
<span id="cb22-47"><a href="#cb22-47" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-48"><a href="#cb22-48" aria-hidden="true" tabindex="-1"></a><span class="co"># remove temporary variables</span></span>
<span id="cb22-49"><a href="#cb22-49" aria-hidden="true" tabindex="-1"></a><span class="fu">rm</span>(url, file_name, file_path, data_path)</span>
<span id="cb22-50"><a href="#cb22-50" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-51"><a href="#cb22-51" aria-hidden="true" tabindex="-1"></a><span class="co">#-----summarize ln_nox-----</span></span>
<span id="cb22-52"><a href="#cb22-52" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-53"><a href="#cb22-53" aria-hidden="true" tabindex="-1"></a><span class="co"># frequencies only</span></span>
<span id="cb22-54"><a href="#cb22-54" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(snapshot<span class="sc">$</span>seasonfac)</span>
<span id="cb22-55"><a href="#cb22-55" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-56"><a href="#cb22-56" aria-hidden="true" tabindex="-1"></a><span class="co"># descriptive statistics</span></span>
<span id="cb22-57"><a href="#cb22-57" aria-hidden="true" tabindex="-1"></a>snapshot_summary <span class="ot">&lt;-</span> snapshot <span class="sc">%&gt;%</span>     </span>
<span id="cb22-58"><a href="#cb22-58" aria-hidden="true" tabindex="-1"></a>    <span class="fu">group_by</span>(seasonfac) <span class="sc">%&gt;%</span></span>
<span id="cb22-59"><a href="#cb22-59" aria-hidden="true" tabindex="-1"></a>    <span class="fu">summarise</span>(<span class="at">N =</span> <span class="fu">n</span>(),</span>
<span id="cb22-60"><a href="#cb22-60" aria-hidden="true" tabindex="-1"></a>              <span class="at">Mean =</span> <span class="fu">mean</span>(ln_nox), </span>
<span id="cb22-61"><a href="#cb22-61" aria-hidden="true" tabindex="-1"></a>              <span class="at">SD =</span> <span class="fu">sd</span>(ln_nox),</span>
<span id="cb22-62"><a href="#cb22-62" aria-hidden="true" tabindex="-1"></a>              <span class="at">GM =</span> <span class="fu">exp</span>(<span class="fu">mean</span>(ln_nox)), </span>
<span id="cb22-63"><a href="#cb22-63" aria-hidden="true" tabindex="-1"></a>              <span class="at">GSD =</span> <span class="fu">exp</span>(<span class="fu">sd</span>(ln_nox)), </span>
<span id="cb22-64"><a href="#cb22-64" aria-hidden="true" tabindex="-1"></a>              <span class="at">.groups =</span> <span class="st">"drop"</span>)</span>
<span id="cb22-65"><a href="#cb22-65" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-66"><a href="#cb22-66" aria-hidden="true" tabindex="-1"></a><span class="co"># kable table</span></span>
<span id="cb22-67"><a href="#cb22-67" aria-hidden="true" tabindex="-1"></a><span class="fu">kable</span>(snapshot_summary, <span class="at">digits=</span><span class="dv">2</span>)</span>
<span id="cb22-68"><a href="#cb22-68" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-69"><a href="#cb22-69" aria-hidden="true" tabindex="-1"></a><span class="co">#-----season-specific boxplots-----</span></span>
<span id="cb22-70"><a href="#cb22-70" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-71"><a href="#cb22-71" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(snapshot, <span class="fu">aes</span>(<span class="at">x =</span> seasonfac, <span class="at">y =</span> ln_nox, <span class="at">fill =</span> seasonfac)) <span class="sc">+</span></span>
<span id="cb22-72"><a href="#cb22-72" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_boxplot</span>() <span class="sc">+</span></span>
<span id="cb22-73"><a href="#cb22-73" aria-hidden="true" tabindex="-1"></a>    <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">"Season"</span>, </span>
<span id="cb22-74"><a href="#cb22-74" aria-hidden="true" tabindex="-1"></a>         <span class="at">y =</span> <span class="st">"ln(NOx) (ln(ppb)"</span>, </span>
<span id="cb22-75"><a href="#cb22-75" aria-hidden="true" tabindex="-1"></a>         <span class="at">color =</span> <span class="st">"Season"</span>, </span>
<span id="cb22-76"><a href="#cb22-76" aria-hidden="true" tabindex="-1"></a>         <span class="at">fill =</span> <span class="st">"Season"</span>) <span class="sc">+</span> </span>
<span id="cb22-77"><a href="#cb22-77" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme_article</span>()</span>
<span id="cb22-78"><a href="#cb22-78" aria-hidden="true" tabindex="-1"></a>       </span>
<span id="cb22-79"><a href="#cb22-79" aria-hidden="true" tabindex="-1"></a><span class="co">#-----regression for association-----</span></span>
<span id="cb22-80"><a href="#cb22-80" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-81"><a href="#cb22-81" aria-hidden="true" tabindex="-1"></a><span class="co"># Common model (Table 4), season-specific LUR</span></span>
<span id="cb22-82"><a href="#cb22-82" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-83"><a href="#cb22-83" aria-hidden="true" tabindex="-1"></a><span class="co"># specify regression model</span></span>
<span id="cb22-84"><a href="#cb22-84" aria-hidden="true" tabindex="-1"></a>frml <span class="ot">&lt;-</span> <span class="fu">as.formula</span>(ln_nox <span class="sc">~</span> D2A1 <span class="sc">+</span> A1_50 <span class="sc">+</span> A23_400 <span class="sc">+</span> Pop_5000 <span class="sc">+</span> D2C <span class="sc">+</span> Int_3000 <span class="sc">+</span> D2Comm)</span>
<span id="cb22-85"><a href="#cb22-85" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-86"><a href="#cb22-86" aria-hidden="true" tabindex="-1"></a><span class="co"># summarize the fit of each model</span></span>
<span id="cb22-87"><a href="#cb22-87" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(lm_summer <span class="ot">&lt;-</span> <span class="fu">lm</span>(frml, <span class="at">data =</span> snapshot, <span class="at">subset =</span> seasonfac <span class="sc">==</span> <span class="st">"1Summer"</span>))</span>
<span id="cb22-88"><a href="#cb22-88" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(lm_fall <span class="ot">&lt;-</span> <span class="fu">lm</span>(frml, <span class="at">data =</span> snapshot, <span class="at">subset =</span> seasonfac <span class="sc">==</span> <span class="st">"2Fall"</span>))</span>
<span id="cb22-89"><a href="#cb22-89" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(lm_winter <span class="ot">&lt;-</span> <span class="fu">lm</span>(frml, <span class="at">data =</span> snapshot, <span class="at">subset =</span> seasonfac <span class="sc">==</span> <span class="st">"3Winter"</span>))</span>
<span id="cb22-90"><a href="#cb22-90" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-91"><a href="#cb22-91" aria-hidden="true" tabindex="-1"></a><span class="co">#-----predictions with dplyr-----</span></span>
<span id="cb22-92"><a href="#cb22-92" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-93"><a href="#cb22-93" aria-hidden="true" tabindex="-1"></a><span class="co"># this adds model-specific predictions, both in-sample and out-of-sample</span></span>
<span id="cb22-94"><a href="#cb22-94" aria-hidden="true" tabindex="-1"></a><span class="co"># however, we don't get the prediction intervals or SEs this way</span></span>
<span id="cb22-95"><a href="#cb22-95" aria-hidden="true" tabindex="-1"></a>snap2 <span class="ot">&lt;-</span> snapshot <span class="sc">%&gt;%</span> </span>
<span id="cb22-96"><a href="#cb22-96" aria-hidden="true" tabindex="-1"></a>    <span class="co"># summer</span></span>
<span id="cb22-97"><a href="#cb22-97" aria-hidden="true" tabindex="-1"></a>    <span class="fu">add_residuals</span>(lm_summer,<span class="st">"resids_sum"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb22-98"><a href="#cb22-98" aria-hidden="true" tabindex="-1"></a>    <span class="fu">add_predictions</span>(lm_summer,<span class="st">"preds_sum"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb22-99"><a href="#cb22-99" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb22-100"><a href="#cb22-100" aria-hidden="true" tabindex="-1"></a>    <span class="co"># fall</span></span>
<span id="cb22-101"><a href="#cb22-101" aria-hidden="true" tabindex="-1"></a>    <span class="fu">add_residuals</span>(lm_fall,<span class="st">"resids_fall"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb22-102"><a href="#cb22-102" aria-hidden="true" tabindex="-1"></a>    <span class="fu">add_predictions</span>(lm_fall,<span class="st">"preds_fall"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb22-103"><a href="#cb22-103" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb22-104"><a href="#cb22-104" aria-hidden="true" tabindex="-1"></a>    <span class="co"># winter</span></span>
<span id="cb22-105"><a href="#cb22-105" aria-hidden="true" tabindex="-1"></a>    <span class="fu">add_residuals</span>(lm_winter,<span class="st">"resids_win"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb22-106"><a href="#cb22-106" aria-hidden="true" tabindex="-1"></a>    <span class="fu">add_predictions</span>(lm_winter,<span class="st">"preds_win"</span>)</span>
<span id="cb22-107"><a href="#cb22-107" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-108"><a href="#cb22-108" aria-hidden="true" tabindex="-1"></a><span class="co"># inspect predictions and residuals</span></span>
<span id="cb22-109"><a href="#cb22-109" aria-hidden="true" tabindex="-1"></a>snap2 <span class="sc">%&gt;%</span> </span>
<span id="cb22-110"><a href="#cb22-110" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(<span class="at">SeasonID =</span> seasonfac, ln_nox, preds_sum, resids_sum, preds_fall,</span>
<span id="cb22-111"><a href="#cb22-111" aria-hidden="true" tabindex="-1"></a>                resids_fall, preds_win, resids_win) <span class="sc">%&gt;%</span> </span>
<span id="cb22-112"><a href="#cb22-112" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate_if</span>(is.double, round, <span class="dv">2</span>)</span>
<span id="cb22-113"><a href="#cb22-113" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-114"><a href="#cb22-114" aria-hidden="true" tabindex="-1"></a><span class="co">#-----in-sample prediction intervals-----</span></span>
<span id="cb22-115"><a href="#cb22-115" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-116"><a href="#cb22-116" aria-hidden="true" tabindex="-1"></a><span class="co"># first get the prediction interval for each season and bind it to the</span></span>
<span id="cb22-117"><a href="#cb22-117" aria-hidden="true" tabindex="-1"></a><span class="co"># season-specific subset of the full dataset</span></span>
<span id="cb22-118"><a href="#cb22-118" aria-hidden="true" tabindex="-1"></a><span class="co"># </span><span class="al">NOTE</span><span class="co">:  We are assuming the two datasets are in the same order when we cbind!</span></span>
<span id="cb22-119"><a href="#cb22-119" aria-hidden="true" tabindex="-1"></a><span class="co"># It is good practice to check and not assume this is correct.</span></span>
<span id="cb22-120"><a href="#cb22-120" aria-hidden="true" tabindex="-1"></a><span class="co"># R gives a warning about the interpretation of these prediction intervals when</span></span>
<span id="cb22-121"><a href="#cb22-121" aria-hidden="true" tabindex="-1"></a><span class="co"># the data to generate the model are the same ones to do prediction.  This</span></span>
<span id="cb22-122"><a href="#cb22-122" aria-hidden="true" tabindex="-1"></a><span class="co"># warning does not appear when the predictions are out of sample (see next</span></span>
<span id="cb22-123"><a href="#cb22-123" aria-hidden="true" tabindex="-1"></a><span class="co"># chunk).</span></span>
<span id="cb22-124"><a href="#cb22-124" aria-hidden="true" tabindex="-1"></a>summer <span class="ot">&lt;-</span> <span class="fu">cbind</span>(snapshot[snapshot<span class="sc">$</span>season<span class="sc">==</span><span class="dv">1</span>,],<span class="fu">predict</span>(lm_summer,<span class="at">interval=</span><span class="st">"prediction"</span>))</span>
<span id="cb22-125"><a href="#cb22-125" aria-hidden="true" tabindex="-1"></a>fall <span class="ot">&lt;-</span> <span class="fu">cbind</span>(snapshot[snapshot<span class="sc">$</span>season<span class="sc">==</span><span class="dv">2</span>,],<span class="fu">predict</span>(lm_fall,<span class="at">interval=</span><span class="st">"prediction"</span>))</span>
<span id="cb22-126"><a href="#cb22-126" aria-hidden="true" tabindex="-1"></a>winter <span class="ot">&lt;-</span> <span class="fu">cbind</span>(snapshot[snapshot<span class="sc">$</span>season<span class="sc">==</span><span class="dv">3</span>,],<span class="fu">predict</span>(lm_winter,<span class="at">interval=</span><span class="st">"prediction"</span>))</span>
<span id="cb22-127"><a href="#cb22-127" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-128"><a href="#cb22-128" aria-hidden="true" tabindex="-1"></a><span class="co"># then combine the dataset into one big tibble</span></span>
<span id="cb22-129"><a href="#cb22-129" aria-hidden="true" tabindex="-1"></a>allseas_in <span class="ot">&lt;-</span> <span class="fu">rbind</span>(summer, fall, winter) <span class="sc">%&gt;%</span> <span class="fu">as_tibble</span>()</span>
<span id="cb22-130"><a href="#cb22-130" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-131"><a href="#cb22-131" aria-hidden="true" tabindex="-1"></a><span class="co"># now use dplyr to rename the predictions (the predict function gives default</span></span>
<span id="cb22-132"><a href="#cb22-132" aria-hidden="true" tabindex="-1"></a><span class="co"># variable names)</span></span>
<span id="cb22-133"><a href="#cb22-133" aria-hidden="true" tabindex="-1"></a>allseas_in <span class="ot">&lt;-</span> <span class="fu">rename</span>(allseas_in, <span class="at">pred_in =</span> fit, <span class="at">lwr_in =</span> lwr, <span class="at">upr_in =</span> upr)</span>
<span id="cb22-134"><a href="#cb22-134" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-135"><a href="#cb22-135" aria-hidden="true" tabindex="-1"></a><span class="co">#-----out-of-sample predictions-----</span></span>
<span id="cb22-136"><a href="#cb22-136" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-137"><a href="#cb22-137" aria-hidden="true" tabindex="-1"></a><span class="co"># This example produces out-of-sample season-specific prediction intervals using</span></span>
<span id="cb22-138"><a href="#cb22-138" aria-hidden="true" tabindex="-1"></a><span class="co"># the previous season to predict the next one.  (Note you should think carefully</span></span>
<span id="cb22-139"><a href="#cb22-139" aria-hidden="true" tabindex="-1"></a><span class="co"># from a scientific perspective about how to approach out-of-sample predictions</span></span>
<span id="cb22-140"><a href="#cb22-140" aria-hidden="true" tabindex="-1"></a><span class="co"># like these.)</span></span>
<span id="cb22-141"><a href="#cb22-141" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-142"><a href="#cb22-142" aria-hidden="true" tabindex="-1"></a><span class="co"># get the prediction interval for each season </span></span>
<span id="cb22-143"><a href="#cb22-143" aria-hidden="true" tabindex="-1"></a>fall_preds_from_summer <span class="ot">&lt;-</span> </span>
<span id="cb22-144"><a href="#cb22-144" aria-hidden="true" tabindex="-1"></a>  <span class="fu">predict</span>(lm_summer, snapshot[snapshot<span class="sc">$</span>season <span class="sc">==</span> <span class="dv">2</span>,], <span class="at">interval =</span> <span class="st">"prediction"</span>)</span>
<span id="cb22-145"><a href="#cb22-145" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-146"><a href="#cb22-146" aria-hidden="true" tabindex="-1"></a>winter_preds_from_fall <span class="ot">&lt;-</span> </span>
<span id="cb22-147"><a href="#cb22-147" aria-hidden="true" tabindex="-1"></a>  <span class="fu">predict</span>(lm_fall, snapshot[snapshot<span class="sc">$</span>season <span class="sc">==</span> <span class="dv">3</span>,], <span class="at">interval =</span> <span class="st">"prediction"</span>)</span>
<span id="cb22-148"><a href="#cb22-148" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-149"><a href="#cb22-149" aria-hidden="true" tabindex="-1"></a>summer_preds_from_winter <span class="ot">&lt;-</span> </span>
<span id="cb22-150"><a href="#cb22-150" aria-hidden="true" tabindex="-1"></a>  <span class="fu">predict</span>(lm_winter, snapshot[snapshot<span class="sc">$</span>season <span class="sc">==</span> <span class="dv">1</span>,], <span class="at">interval =</span> <span class="st">"prediction"</span>)</span>
<span id="cb22-151"><a href="#cb22-151" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-152"><a href="#cb22-152" aria-hidden="true" tabindex="-1"></a><span class="co"># then combine the dataset into one big tibble and rename variables</span></span>
<span id="cb22-153"><a href="#cb22-153" aria-hidden="true" tabindex="-1"></a>allseas_out <span class="ot">&lt;-</span> <span class="fu">rbind</span>(summer_preds_from_winter, </span>
<span id="cb22-154"><a href="#cb22-154" aria-hidden="true" tabindex="-1"></a>                     fall_preds_from_summer,</span>
<span id="cb22-155"><a href="#cb22-155" aria-hidden="true" tabindex="-1"></a>                     winter_preds_from_fall) <span class="sc">%&gt;%</span> </span>
<span id="cb22-156"><a href="#cb22-156" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as_tibble</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb22-157"><a href="#cb22-157" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="at">pred_out =</span> fit, <span class="at">lwr_out =</span> lwr, <span class="at">upr_out =</span> upr)</span>
<span id="cb22-158"><a href="#cb22-158" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-159"><a href="#cb22-159" aria-hidden="true" tabindex="-1"></a><span class="co"># Bind "out" predictions to the previous dataset with "in" sample predictions</span></span>
<span id="cb22-160"><a href="#cb22-160" aria-hidden="true" tabindex="-1"></a><span class="co"># </span><span class="al">NOTE</span><span class="co">:  We assume the datasets are in the same order!</span></span>
<span id="cb22-161"><a href="#cb22-161" aria-hidden="true" tabindex="-1"></a>allseas_both <span class="ot">&lt;-</span> <span class="fu">cbind</span>(allseas_in, allseas_out)</span>
<span id="cb22-162"><a href="#cb22-162" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-163"><a href="#cb22-163" aria-hidden="true" tabindex="-1"></a><span class="co">#-----prediction assessment-----</span></span>
<span id="cb22-164"><a href="#cb22-164" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-165"><a href="#cb22-165" aria-hidden="true" tabindex="-1"></a><span class="co"># summer in-sample</span></span>
<span id="cb22-166"><a href="#cb22-166" aria-hidden="true" tabindex="-1"></a><span class="fu">paste</span>(<span class="st">"summer in-sample R2:  "</span>, </span>
<span id="cb22-167"><a href="#cb22-167" aria-hidden="true" tabindex="-1"></a>      <span class="fu">with</span>(<span class="fu">subset</span>(allseas_both, season <span class="sc">==</span> <span class="dv">1</span>), <span class="fu">round</span>(<span class="fu">cor</span>(ln_nox, pred_in)<span class="sc">^</span><span class="dv">2</span>, <span class="dv">3</span>))) </span>
<span id="cb22-168"><a href="#cb22-168" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-169"><a href="#cb22-169" aria-hidden="true" tabindex="-1"></a><span class="co"># summer out-of-sample (from winter model)</span></span>
<span id="cb22-170"><a href="#cb22-170" aria-hidden="true" tabindex="-1"></a><span class="fu">paste</span>(<span class="st">"summer out-of-sample R2 (from winter model):  "</span>, </span>
<span id="cb22-171"><a href="#cb22-171" aria-hidden="true" tabindex="-1"></a>      <span class="fu">with</span>(<span class="fu">subset</span>(allseas_both, season <span class="sc">==</span> <span class="dv">1</span>), <span class="fu">round</span>(<span class="fu">cor</span>(ln_nox, pred_out)<span class="sc">^</span><span class="dv">2</span>,<span class="dv">3</span>)))</span>
<span id="cb22-172"><a href="#cb22-172" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-173"><a href="#cb22-173" aria-hidden="true" tabindex="-1"></a><span class="co">#-----summer in and out of sample-----</span></span>
<span id="cb22-174"><a href="#cb22-174" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-175"><a href="#cb22-175" aria-hidden="true" tabindex="-1"></a><span class="co"># plot the predictions vs. data for summer, both in-sample and out of sample</span></span>
<span id="cb22-176"><a href="#cb22-176" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-177"><a href="#cb22-177" aria-hidden="true" tabindex="-1"></a><span class="co"># get the range of the data to use as limits in the plots</span></span>
<span id="cb22-178"><a href="#cb22-178" aria-hidden="true" tabindex="-1"></a>r <span class="ot">&lt;-</span> allseas_both <span class="sc">%&gt;%</span> </span>
<span id="cb22-179"><a href="#cb22-179" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(season <span class="sc">==</span> <span class="dv">1</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb22-180"><a href="#cb22-180" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(pred_in, pred_out, ln_nox) <span class="sc">%&gt;%</span> </span>
<span id="cb22-181"><a href="#cb22-181" aria-hidden="true" tabindex="-1"></a>  <span class="fu">range</span>()</span>
<span id="cb22-182"><a href="#cb22-182" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-183"><a href="#cb22-183" aria-hidden="true" tabindex="-1"></a><span class="co"># in-sample plot</span></span>
<span id="cb22-184"><a href="#cb22-184" aria-hidden="true" tabindex="-1"></a>p_in <span class="ot">&lt;-</span> allseas_both <span class="sc">%&gt;%</span></span>
<span id="cb22-185"><a href="#cb22-185" aria-hidden="true" tabindex="-1"></a>    <span class="fu">filter</span>(season <span class="sc">==</span> <span class="dv">1</span>) <span class="sc">%&gt;%</span></span>
<span id="cb22-186"><a href="#cb22-186" aria-hidden="true" tabindex="-1"></a>    <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> pred_in, <span class="at">y =</span> ln_nox)) <span class="sc">+</span></span>
<span id="cb22-187"><a href="#cb22-187" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb22-188"><a href="#cb22-188" aria-hidden="true" tabindex="-1"></a>    <span class="fu">lims</span>(<span class="at">x =</span> <span class="fu">c</span>(r[<span class="dv">1</span>], r[<span class="dv">2</span>]), <span class="at">y =</span> <span class="fu">c</span>(r[<span class="dv">1</span>], r[<span class="dv">2</span>]) ) <span class="sc">+</span></span>
<span id="cb22-189"><a href="#cb22-189" aria-hidden="true" tabindex="-1"></a>    <span class="fu">coord_fixed</span>() <span class="sc">+</span></span>
<span id="cb22-190"><a href="#cb22-190" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_abline</span>(<span class="at">intercept =</span> <span class="dv">0</span>, <span class="at">slope =</span> <span class="dv">1</span>, <span class="at">color =</span> <span class="st">"blue"</span>) <span class="sc">+</span></span>
<span id="cb22-191"><a href="#cb22-191" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_smooth</span>(<span class="at">method =</span> <span class="st">"lm"</span>, <span class="at">se =</span> <span class="cn">FALSE</span>, <span class="at">color =</span> <span class="st">"red"</span>) <span class="sc">+</span></span>
<span id="cb22-192"><a href="#cb22-192" aria-hidden="true" tabindex="-1"></a>    <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"In-sample"</span>, </span>
<span id="cb22-193"><a href="#cb22-193" aria-hidden="true" tabindex="-1"></a>         <span class="at">x =</span> <span class="st">"In-sample predicted ln(NOx) (ln(ppb))"</span>,</span>
<span id="cb22-194"><a href="#cb22-194" aria-hidden="true" tabindex="-1"></a>         <span class="at">y =</span> <span class="st">"Observed ln(NOx) (ln(ppb))"</span></span>
<span id="cb22-195"><a href="#cb22-195" aria-hidden="true" tabindex="-1"></a>         ) <span class="sc">+</span> </span>
<span id="cb22-196"><a href="#cb22-196" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme_bw</span>()</span>
<span id="cb22-197"><a href="#cb22-197" aria-hidden="true" tabindex="-1"></a> </span>
<span id="cb22-198"><a href="#cb22-198" aria-hidden="true" tabindex="-1"></a><span class="co"># out-of-sample plot (predictions from the winter model)</span></span>
<span id="cb22-199"><a href="#cb22-199" aria-hidden="true" tabindex="-1"></a>p_out <span class="ot">&lt;-</span> allseas_both <span class="sc">%&gt;%</span></span>
<span id="cb22-200"><a href="#cb22-200" aria-hidden="true" tabindex="-1"></a>    <span class="fu">filter</span>(season <span class="sc">==</span> <span class="dv">1</span>) <span class="sc">%&gt;%</span></span>
<span id="cb22-201"><a href="#cb22-201" aria-hidden="true" tabindex="-1"></a>    <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x=</span>pred_out, <span class="at">y=</span>ln_nox)) <span class="sc">+</span></span>
<span id="cb22-202"><a href="#cb22-202" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb22-203"><a href="#cb22-203" aria-hidden="true" tabindex="-1"></a>    <span class="fu">lims</span>(<span class="at">x =</span> <span class="fu">c</span>(r[<span class="dv">1</span>], r[<span class="dv">2</span>]), <span class="at">y =</span> <span class="fu">c</span>(r[<span class="dv">1</span>], r[<span class="dv">2</span>]) ) <span class="sc">+</span></span>
<span id="cb22-204"><a href="#cb22-204" aria-hidden="true" tabindex="-1"></a>    <span class="fu">coord_fixed</span>() <span class="sc">+</span></span>
<span id="cb22-205"><a href="#cb22-205" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_abline</span>(<span class="at">intercept =</span> <span class="dv">0</span>, <span class="at">slope =</span> <span class="dv">1</span>, <span class="at">color =</span> <span class="st">"blue"</span>) <span class="sc">+</span></span>
<span id="cb22-206"><a href="#cb22-206" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_smooth</span>(<span class="at">method =</span> <span class="st">"lm"</span>, <span class="at">se =</span> <span class="cn">FALSE</span>, <span class="at">color =</span> <span class="st">"red"</span>) <span class="sc">+</span></span>
<span id="cb22-207"><a href="#cb22-207" aria-hidden="true" tabindex="-1"></a>    <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Out-of-sample (from winter model)"</span>, </span>
<span id="cb22-208"><a href="#cb22-208" aria-hidden="true" tabindex="-1"></a>         <span class="at">x =</span> <span class="st">"Out-of-sample predicted ln(NOx) (ln(ppb))"</span>,</span>
<span id="cb22-209"><a href="#cb22-209" aria-hidden="true" tabindex="-1"></a>         <span class="at">y =</span> <span class="st">"Observed ln(NOx) (ln(ppb))"</span></span>
<span id="cb22-210"><a href="#cb22-210" aria-hidden="true" tabindex="-1"></a>         ) <span class="sc">+</span> </span>
<span id="cb22-211"><a href="#cb22-211" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme_bw</span>()</span>
<span id="cb22-212"><a href="#cb22-212" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-213"><a href="#cb22-213" aria-hidden="true" tabindex="-1"></a><span class="co"># combine plots into one display</span></span>
<span id="cb22-214"><a href="#cb22-214" aria-hidden="true" tabindex="-1"></a><span class="fu">ggarrange</span>(p_in, p_out, <span class="at">ncol =</span> <span class="dv">2</span>, </span>
<span id="cb22-215"><a href="#cb22-215" aria-hidden="true" tabindex="-1"></a>          <span class="at">top =</span> <span class="st">"Summer Model ln(NOx) Predictions"</span>, </span>
<span id="cb22-216"><a href="#cb22-216" aria-hidden="true" tabindex="-1"></a>          <span class="at">bottom =</span> <span class="st">"Best fit line is red; 1:1 line is blue"</span>)</span>
<span id="cb22-217"><a href="#cb22-217" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-218"><a href="#cb22-218" aria-hidden="true" tabindex="-1"></a><span class="co">#-----session information----</span></span>
<span id="cb22-219"><a href="#cb22-219" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-220"><a href="#cb22-220" aria-hidden="true" tabindex="-1"></a><span class="co"># print R session information</span></span>
<span id="cb22-221"><a href="#cb22-221" aria-hidden="true" tabindex="-1"></a><span class="fu">sessionInfo</span>()</span>
<span id="cb22-222"><a href="#cb22-222" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-223"><a href="#cb22-223" aria-hidden="true" tabindex="-1"></a><span class="co">#-----code appendix----</span></span>
<span id="cb22-224"><a href="#cb22-224" aria-hidden="true" tabindex="-1"></a><span class="co">#-----functions----</span></span>
<span id="cb22-225"><a href="#cb22-225" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-226"><a href="#cb22-226" aria-hidden="true" tabindex="-1"></a><span class="co"># Show the names of all functions defined in the .Rmd</span></span>
<span id="cb22-227"><a href="#cb22-227" aria-hidden="true" tabindex="-1"></a><span class="co"># (e.g. loaded in the environment)</span></span>
<span id="cb22-228"><a href="#cb22-228" aria-hidden="true" tabindex="-1"></a><span class="fu">lsf.str</span>()</span>
<span id="cb22-229"><a href="#cb22-229" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-230"><a href="#cb22-230" aria-hidden="true" tabindex="-1"></a><span class="co"># Show the definitions of all functions loaded into the current environment  </span></span>
<span id="cb22-231"><a href="#cb22-231" aria-hidden="true" tabindex="-1"></a><span class="fu">lsf.str</span>() <span class="sc">%&gt;%</span> <span class="fu">set_names</span>() <span class="sc">%&gt;%</span> <span class="fu">map</span>(get, .GlobalEnv)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb23"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a><span class="co">#-----functions----</span></span>
<span id="cb23-2"><a href="#cb23-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-3"><a href="#cb23-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Show the names of all functions defined in the .Rmd</span></span>
<span id="cb23-4"><a href="#cb23-4" aria-hidden="true" tabindex="-1"></a><span class="co"># (e.g. loaded in the environment)</span></span>
<span id="cb23-5"><a href="#cb23-5" aria-hidden="true" tabindex="-1"></a><span class="fu">lsf.str</span>()</span>
<span id="cb23-6"><a href="#cb23-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-7"><a href="#cb23-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Show the definitions of all functions loaded into the current environment  </span></span>
<span id="cb23-8"><a href="#cb23-8" aria-hidden="true" tabindex="-1"></a><span class="fu">lsf.str</span>() <span class="sc">%&gt;%</span> <span class="fu">set_names</span>() <span class="sc">%&gt;%</span> <span class="fu">map</span>(get, .GlobalEnv)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>named list()</code></pre>
</div>
</div>
</section>

</main>
<!-- /main column -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->



</body></html>